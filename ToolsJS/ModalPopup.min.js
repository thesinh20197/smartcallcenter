var EventNameMP={show:"show",hide:"hide"};function ModalPopup(idData,title,isAllowMove){if(idData==null)return;this.disNone="none";this.elTitle=null;this.elTitleText=null;this.elContent=null;this.elContainer=null;this.elData=null;this.title=title;this.isShow=false;this.startMove=false;this.detalCoord={X:0,Y:0};this.positionMoved={X:-1,Y:-1};this.positionDetal={X:-1,Y:-1};this.heightTitleBar=0;this.listEvent=new Array();this.isHideButtonClose=false;this.elBtnClose=null;this.isShowTitle=title!=null&&title!="";this.isAllowMove=isAllowMove!=null?isAllowMove:true;this.zIndex=1000;this.createMain(idData);};ModalPopup.prototype.clear=function(){};ModalPopup.prototype.createMain=function(idData){this.elData=this.getElData(idData);var self=this;function onResize(e){self.setCenter();}
function onScroll(e){self.changePostionResize(e);}
function onKeydown(e){if(e.keyCode==27){self.hide(e);}}
utilObj.addEvent(utilObj.wd,"resize",onResize);utilObj.addEvent(utilObj.wd,"scroll",onScroll);utilObj.addEvent(document,"keydown",onKeydown);this.clear=function(){utilObj.removeEvent(utilObj.wd,"resize",onResize);utilObj.removeEvent(utilObj.wd,"scroll",onScroll);utilObj.removeEvent(document,"keydown",onKeydown);if(self.elContainer!=null&&self.elContent!=null){document.body.removeChild(self.elContent);document.body.removeChild(self.elContainer);self.elContainer=self.elContent=null;}}
this.createContainer();this.createContent();if(this.isAllowMove){this.move();}};ModalPopup.prototype.executeEvent=function(e,eventName){if(this.listEvent[eventName]!=null){for(var i=0;i<this.listEvent[eventName].length;i++){this.listEvent[eventName][i](e);}}};ModalPopup.prototype.addEvent=function(eventName,func){if(this.listEvent[eventName]==null){this.listEvent[eventName]=[];}
this.listEvent[eventName].push(func);};ModalPopup.prototype.removeEvent=function(eventName,func){if(this.listEvent[eventName]==null){return;}
for(var i=0;i<this.listEvent[eventName].length;i++){if(func==this.listEvent[eventName][i]){this.listEvent[eventName].splice(i,1);break;}}};ModalPopup.prototype.createStyle=function(){var cssStr=".ModalPopupContainer { background-color:#FFFFFF; filter:alpha(opacity=50); -moz-opacity:.50; opacity:.50; }";cssStr+=".ModalPopupChild { background-color:#FFFFFF; border-style:solid; border-width:1px; border-radius: 2px; -moz-border-radius: 2px; -webkit-border-radius: 2px; border: 1px solid #AAA; -moz-box-shadow: 3px 3px 15px #bbb; -webkit-box-shadow: 3px 3px 15px #BBB; box-shadow: 3px 3px 15px #BBB; }";cssStr+=".ModalPopupChild .title { max-width:1000px; font-family:Tahoma, Arial, sans-serif !important; font-size:9pt !important; background: url('/ToolsJS/GridView/Images/BgHeader.gif') repeat-x #DDECFF; color:#283B56; font-weight:bold; text-align:left; position:relative; padding:5px !important; cursor:move; border-bottom:solid 1px #aaa; text-align:center; }";cssStr+=".ModalPopupChild .title .btnClose { font-size:10pt; text-decoration:none; border-left:solid 1px #AAA; color:#fff; right:0px; top:0px; padding: 4px 20px 4px; position:absolute; display:block; cursor:pointer; background: #f3c5bd; background: -moz-linear-gradient(top,  #f3c5bd 0%, #e86c57 50%, #ea2803 51%, #ff6600 75%, #ff0000 100%); background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f3c5bd), color-stop(50%,#e86c57), color-stop(51%,#ea2803), color-stop(75%,#ff6600), color-stop(100%,#ff0000)); background: -webkit-linear-gradient(top,  #f3c5bd 0%,#e86c57 50%,#ea2803 51%,#ff6600 75%,#ff0000 100%); background: -o-linear-gradient(top,  #f3c5bd 0%,#e86c57 50%,#ea2803 51%,#ff6600 75%,#ff0000 100%); background: -ms-linear-gradient(top,  #f3c5bd 0%,#e86c57 50%,#ea2803 51%,#ff6600 75%,#ff0000 100%); background: linear-gradient(to bottom,  #f3c5bd 0%,#e86c57 50%,#ea2803 51%,#ff6600 75%,#ff0000 100%); filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f3c5bd', endColorstr='#ff0000',GradientType=0 ); text-shadow: 0 0 0.3em #555766, 0 0 0.3em #555766, 0 0 0.3em #555766; }";cssStr+=".ModalPopupChild .title .btnClose:hover { -moz-box-shadow: 0 0 15px #a73e34; -webkit-box-shadow: 0 0 15px #a73e34; box-shadow: 0 0 15px #a73e34; }";cssStr+=".ModalPopupChild .title span { margin-right:20px; }";var eStyle=utilObj.getElById("idStyleModalPopup");if(eStyle==null){eStyle=utilObj.createEl("STYLE");eStyle.id="idStyleModalPopup";eStyle.setAttribute("type","text/css");utilObj.d.getElementsByTagName('head')[0].appendChild(eStyle);if(eStyle.styleSheet){eStyle.styleSheet.cssText=cssStr;}
else{var cssText=utilObj.createElText(cssStr);eStyle.appendChild(cssText);}}};ModalPopup.prototype.getElData=function(idData){var el=idData;if(typeof idData=="string"){el=utilObj.getElById(idData);}
el.style.padding="5px";return el;};ModalPopup.prototype.getElTitleMove=function(e){var elTarget=utilObj.getTargetElement();if(elTarget==this.elTitle||this.elTitleText==elTarget){return elTarget;}
return null;};ModalPopup.prototype.onMovePopupMouseDown=function(e){if(!this.isAllowMove)return;e=utilObj.getWindowEvent();if(utilObj.isRightClick(e))return;var elTitle=this.getElTitleMove();if(elTitle==null)return;this.startMove=true;var mouseCoords=utilObj.mouseCoords(e);var elContentPos=utilObj.getElementPositionView(this.elContent);this.detalCoord={X:mouseCoords.X-elContentPos.X,Y:mouseCoords.Y-elContentPos.Y};utilObj.disableSelection(document.body);utilObj.stopEvent();};ModalPopup.prototype.onMovePopupMouseMove=function(e){if(!this.isAllowMove||!this.startMove)return;e=utilObj.getWindowEvent();var mouseCoords=utilObj.mouseCoords(e);var docScroll=utilObj.getDocumentScroll();this.positionMoved={X:mouseCoords.X-this.detalCoord.X-docScroll.scrollLeft,Y:mouseCoords.Y-this.detalCoord.Y-docScroll.scrollTop};this.elContent.style.left=this.positionMoved.X+"px";this.elContent.style.top=this.positionMoved.Y+"px";if(this.positionMoved.Y<0){this.elContent.style.top="0px";}
else{var clientSize=utilObj.getDocument();if(this.positionMoved.Y+this.heightTitleBar>clientSize.clientHeight){this.elContent.style.top=(clientSize.clientHeight-this.heightTitleBar)+"px";}}
this.positionDetal={X:this.positionMoved.X-docScroll.scrollLeft,Y:this.positionMoved.Y-docScroll.scrollTop};};ModalPopup.prototype.onMovePopupMouseUp=function(e){if(!this.isAllowMove||!this.startMove)return;this.startMove=false;utilObj.enableSelection(document.body);};ModalPopup.prototype.move=function(){var self=this;utilObj.addEvent(document,"mousedown",function(e){self.onMovePopupMouseDown(e);});utilObj.addEvent(document,"mousemove",function(e){self.onMovePopupMouseMove(e);});utilObj.addEvent(document,"mouseup",function(e){self.onMovePopupMouseUp(e);});};ModalPopup.prototype.createTitle=function(){var self=this;var elTitle=utilObj.createEl("DIV");elTitle.className="title";this.elContent.appendChild(elTitle);this.elTitle=elTitle;this.elTitleText=utilObj.createEl("SPAN");this.elTitleText.innerHTML=this.title;elTitle.appendChild(this.elTitleText);var elBtnClose=utilObj.createEl("A");elBtnClose.className="btnClose";elBtnClose.href='javascript:;';elBtnClose.innerHTML="X";utilObj.addEvent(elBtnClose,"click",function(e){self.hide(e);});elTitle.appendChild(elBtnClose);this.elBtnClose=elBtnClose;this.elTitle.style.display=!this.isShowTitle?this.disNone:"";};ModalPopup.prototype.setTitle=function(text){if(this.elTitle==null)return;this.elTitle.style.display=text.trim()==""?this.disNone:"";this.title=text;this.elTitleText.innerHTML=text;var styleDis=this.elContent.style.display;this.elContent.style.display="";this.heightTitleBar=utilObj.getElementSize(this.elTitle).height;this.elContent.style.display=styleDis;}
ModalPopup.prototype.setHideButtonClose=function(isHideButtonClose){this.isHideButtonClose=isHideButtonClose;this.elBtnClose.style.display=isHideButtonClose?"none":"";}
ModalPopup.prototype.createContent=function(){var elContent=utilObj.createEl("DIV");elContent.className="ModalPopupChild";elContent.style.zIndex=this.zIndex+1;this.elContent=elContent;utilObj.addChildToBody(elContent);this.createTitle();elContent.appendChild(this.elData);elContent.style.display=this.disNone;};ModalPopup.prototype.createContainer=function(){if(!this.elContainer){this.createStyle();var elContainer=utilObj.createEl("DIV");elContainer.className="ModalPopupContainer";elContainer.style.zIndex=this.zIndex;utilObj.addChildToBody(elContainer);this.elContainer=elContainer;this.hide();}};ModalPopup.prototype.setZIndex=function(zIndex){this.zIndex=zIndex;this.elContainer.style.zIndex=zIndex;this.elContent.style.zIndex=zIndex+1;};ModalPopup.prototype.changePostionResize=function(e){if(this.isShow&&this.elContainer&&this.elContent){if(utilObj.isIE&&utilObj.appVersion<7){this.elContainer.style.position=this.elContent.style.position="absolute";var docScroll=utilObj.getDocumentScroll();this.elContainer.style.top=docScroll.scrollTop+"px";this.elContainer.style.left=docScroll.scrollLeft+"px";if(this.positionDetal.X==-1){var pos=utilObj.getElPosCenterWebPage(this.elContent);this.positionDetal={X:pos.X-docScroll.scrollLeft,Y:pos.Y-docScroll.scrollTop};}
this.positionMoved={X:docScroll.scrollLeft+this.positionDetal.X,Y:docScroll.scrollTop+this.positionDetal.Y};this.elContent.style.top=this.positionMoved.Y+"px";this.elContent.style.left=this.positionMoved.X+"px";}}};ModalPopup.prototype.fullScreen=function(){if(this.isFullScreen){this.isFullScreen=false;if(this.firstSize!=null){this.elContent.style.height=this.firstSize.height;this.elContent.style.width=this.firstSize.width;this.elContent.style.top=this.firstPosition.Y;this.elContent.style.left=this.firstPosition.X;}}
else{var elSize=utilObj.getElementSize(this.elContent);this.firstPosition={X:this.elContent.style.left,Y:this.elContent.style.top};this.firstSize={width:elSize.width+"px",height:elSize.height+"px"};var de=utilObj.getDocument();this.elContent.style.height=de.clientHeight+"px";this.elContent.style.width=de.clientWidth+"px";if(this.elContent.style.setProperty){this.elContent.style.setProperty('max-width',de.clientWidth+'px','important');}
this.elContent.style.top=this.elContent.style.left="0px";this.isFullScreen=true;}};ModalPopup.prototype.setCenter=function(){if(this.isShow&&this.elContainer&&this.elContent){this.elData.style.display=this.elContainer.style.display=this.elContent.style.display="";var de=utilObj.getDocument();this.heightTitleBar=utilObj.getElementSize(this.elTitle).height;this.elContainer.style.height=de.clientHeight+"px";this.elContainer.style.width=de.clientWidth+"px";if(utilObj.isIE&&utilObj.appVersion<7){this.changePostionResize();}
else{this.elContainer.style.height=(de.clientHeight+18)+"px";this.elContainer.style.width=(de.clientWidth+18)+"px";this.elContainer.style.position=this.elContent.style.position="fixed";this.elContainer.style.top=this.elContainer.style.left="0px";var elSize=utilObj.getElementSize(this.elContent);if(this.positionMoved.X!=-1){this.elContent.style.top=(this.positionMoved.Y<0?0:this.positionMoved.Y)+"px";this.elContent.style.left=this.positionMoved.X+"px";}
else{var top=(de.clientHeight-elSize.height)/2;this.elContent.style.top=(top<0?0:top)+"px";this.elContent.style.left=((de.clientWidth-elSize.width)/2)+"px";}}}};ModalPopup.prototype.getPosition=function(){if(this.elContent){return{X:parseInt(this.elContent.style.left,10),Y:parseInt(this.elContent.style.top,10)};}
return{X:0,Y:0};};ModalPopup.prototype.setPosition=function(position){if(this.elContent){this.elContent.style.top=position.Y+"px";this.elContent.style.left=position.X+"px";}};ModalPopup.prototype.setSize=function(size){if(this.elContent){this.elContent.style.width=size.width+"px";this.elContent.style.height=size.height+"px";}};ModalPopup.prototype.getSize=function(){if(this.elContent){return utilObj.getElementSize(this.elContent);}
return{width:0,height:0};};ModalPopup.prototype.display=function(){this.isShow=true;this.setCenter();this.executeEvent({},EventNameMP.show);};ModalPopup.prototype.hide=function(){if(!this.isShow)return;this.isShow=false;if(this.elContainer!=null&&this.elContent!=null&&!this.isHideButtonClose){this.elContainer.style.display=this.elContent.style.display=this.disNone;this.elContainer.style.top=this.elContainer.style.left=this.elContent.style.top=this.elContent.style.left="-1000px";}
this.executeEvent({},EventNameMP.hide);};
