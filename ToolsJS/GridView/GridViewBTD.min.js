var EventName={beforeSubmit:"beforeSubmit",submit:"submit",submitComplete:"submitComplete",pagingChange:"pagingChange",sort:"sortColumn",filter:"filterColumn",showOrHideColumn:"showOrHideColumn",click:"click",blur:"blur",focus:"focus",change:"change",dblClick:"dblclick",keyDown:"keydown",keyPress:"keypress",keyUp:"keyup",mouseDown:"mousedown",mouseUp:"mouseup",mouseOver:"mouseover",mouseMove:"mousemove",mouseOut:"mouseout",rowDataBound:"rowDataBound",rowDataBoundDetail:"rowDataBoundDetail",rowClick:"rowClick",rowDblClick:"rowDblClick",rowMouseDown:"rowMouseDown",rowMouseUp:"rowMouseUp",rowMouseOver:"rowMouseOver",rowMouseMove:"rowMouseMove",rowMouseOut:"rowMouseOut",insertNewRecord:"insertNewRecord",editRecord:"editRecord",deleteRecord:"deleteRecord"};var BoundStatus={insert:"Insert",update:"Update",remove:"Remove"};var ColummType={radioBox:"RadioBox",tripleBox:"TripleBox",labelCheckBox:"LabelCheckBox",checkBox:"CheckBox",textBox:"TextBox",password:"Password",labelMultiSelectBox:"LabelMultiSelectBox",multiSelectBox:"MultiSelectBox",labelSelectBox:"LabelSelectBox",labelEditSelectBox:"LabelEditSelectBox",selectBox:"SelectBox",label:"Label",labelDate:"LabelDate",labelTime:"LabelTime",labelDateTime:"LabelDateTime",linkButton:"LinkButton",hyperLink:"HyperLink",image:"Image",file:"File",textArea:"TextArea",richText:"RichText",email:"Email",number:"Number",labelNumber:"LabelNumber",date:"Date",time:"Time",color:"Color",formula:"Formula",keyUpdate:"KeyUpdate",none:"None"};var SortType={none:"None",asc:"ASC",desc:"DESC",noSort:"noSort"};var Operator={contains:6,equal:1,greaterEqual:4,lessEqual:5,different:8,moreValue:9,moreValueColor:10};GridViewBTD=function(objContainer,configData,myName){if(objContainer==null)return;this.configData=configData;var documentSize=utilObj.getDocument();this.configData.heightGrid=configData.heightGrid==null?documentSize.clientHeight-150:configData.heightGrid;this.myName=myName;this.isBTD=true;this.objContainer=objContainer;this.elContainerGV=null;this.elCellContainerGV=null;this.elRowEdit=null;this.elHeaderRow=null;this.elFilterHeaderRow=null;this.listMapHeader=[];this.widthOfFunctionColumn=120;this.widthOfSelectionColumn=22;this.hasError=false;this.borderCss='1px solid #ccc';this.dicRow={};this.isShowFilterHeaderRow=false;this.dicColumSort={};this.elSelectionAll=null;this.elRowStartSelection=null;this.textTitleFormUpdate="Cập nhật biểu mẩu";this.hasFile=false;this.isAddNewRecord=true;this.elContainerFormUpdate=null;this.elTableFormUpdate=null;this.popupFormUpdate=new ModalPopup();this.useUpdateDataSystem=false;this.cookieName="";this.oCacheHeader=null;this.elMoveColumn=null;this.elIconMoveColumn=null;this.elCellNeedMove=null;this.detalCoord={X:0,Y:0};this.startMoveCol=false;this.canMove=false;this.widthToResize=5;this.gvWidth=0;this.elCellResizing=null;this.canResize=false;this.startResizeCol=false;this.elResizeDisplay=null;this.elMainMenu=null;this.elItemActiveMM=null;this.elSortMenu=null;this.elSortCellTHead=null;this.isOverMenuColumn=false;this.elBtnShowCol=null;this.elMenuColumn=null;this.isShowBtn=false;this.isShowMenu=false;this.listEvent=new Array();this.isShowTextFunction=true;this.isHideColumnFunction=false;this.isShowAddNew=false;this.isShowEdit=true;this.isShowDelete=false;this.isShowPaging=false;this.isShowAllPage=false;this.isShowTotal=false;this.isAllowResizeColumn=false;this.isAllowMoveColumn=false;this.isAllowHideColumn=false;this.isAllowSortColumn=false;this.isAllowSortColumnByClickHeader=false;this.isAllowFilterColumn=false;this.isAllowStoreCookie=false;this.isAllowSelectRow=false;this.heightOfTable=0;this.condition=null;this.currentPage=1;this.pagingRecord={begin:0,end:0};this.elPageChoose=null;this.currentIndexContainerPage=1;this.listContainerPages=new Array();this.viewRecord=0;this.totalPage=1;this.totalRecord=0;this.maxPage=10;this.elContainerPagingPreview=null;this.elContainerPagingNext=null;this.cssHeaderTD="headerTD";this.cssHeaderText="headerText";this.cssBtnShowCol="btnShowCol";this.cssContainerPaging="containerPaging";};GridViewBTD.prototype.disposeAllParameter=function(){this.configData=null;this.isBTD=true;this.elContainerGV=null;this.elCellContainerGV=null;this.elRowEdit=null;this.elHeaderRow=null;this.elFilterHeaderRow=null;this.listMapHeader=[];this.dicRow={};this.elSelectionAll=null;this.textTitleFormUpdate="Cập nhật biểu mẩu";this.hasFile=false;this.isAddNewRecord=true;this.elContainerFormUpdate=null;this.elTableFormUpdate=null;this.popupFormUpdate=null;this.useUpdateDataSystem=false;this.cookieName="";this.oCacheHeader=null;this.elRowStartSelection=null;this.elMoveColumn=null;this.elIconMoveColumn=null;this.elCellNeedMove=null;this.detalCoord={X:0,Y:0};this.startMoveCol=false;this.canMove=false;this.widthToResize=5;this.gvWidth=0;this.elCellResizing=null;this.canResize=false;this.startResizeCol=false;if(this.elResizeDisplay!=null){document.body.removeChild(this.elResizeDisplay);this.elResizeDisplay=null;}
this.elMainMenu=null;this.elItemActiveMM=null;this.elSortMenu=null;this.elSortCellTHead=null;this.isOverMenuColumn=false;this.elBtnShowCol=null;this.elMenuColumn=null;this.isShowBtn=false;this.isShowMenu=false;this.listEvent=new Array();this.isShowAddNew=false;this.isShowEdit=true;this.isShowDelete=false;this.isShowPaging=false;this.isShowAllPage=false;this.isShowTotal=false;this.isAllowResizeColumn=false;this.isAllowMoveColumn=false;this.isAllowHideColumn=false;this.isAllowSortColumn=false;this.isAllowFilterColumn=false;this.isAllowStoreCookie=false;this.isAllowSelectRow=false;this.heightOfTable=0;this.condition=null;this.currentPage=1;this.pagingRecord={begin:0,end:0};this.elPageChoose=null;this.currentIndexContainerPage=1;this.listContainerPages=new Array();this.viewRecord=0;this.totalPage=1;this.totalRecord=0;this.maxPage=10;this.elContainerPagingPreview=null;this.elContainerPagingNext=null;};GridViewBTD.prototype.dispose=function(){this.disposeMainMenu();this.disposeMenuColumn();this.disposeGridView();this.disposeFormUpdate();this.disposeAllParameter();};GridViewBTD.prototype.createCookieName=function(){var url=location.href.split("?")[0].split("#")[0]+this.myName;var strSpe="_=(;)$.";for(var i=0;i<strSpe.length;i++){url=url.replace(new RegExp("\\"+strSpe.charAt(i),"gi"),"_"+i);}
this.cookieName=url;};GridViewBTD.prototype.setStoreCache=function(cacheHeader){this.oCacheHeader=cacheHeader;}
GridViewBTD.prototype.getStoreCache=function(){var oCacheHeader=new Object();for(var i=0;i<this.listMapHeader.length;i++){var elCell=this.listMapHeader[i].elCell;var item=this.listMapHeader[i].item;oCacheHeader[item.name]={position:elCell.cellIndex,display:elCell.style.display!="none"?"":"none",width:item.width,sortType:item.sortType};}
return oCacheHeader;}
GridViewBTD.prototype.setCookie=function(){this.oCacheHeader=this.getStoreCache();utilObj.setCookie(this.cookieName,JSON.stringify(this.oCacheHeader));};GridViewBTD.prototype.getCookie=function(){if(this.oCacheHeader!=null)return this.oCacheHeader;var value=utilObj.getCookie(this.cookieName);if(value!=null){value=JSON.eval(value);for(var i=0;i<this.configData.head.length;i++){var item=this.configData.head[i];if(value[item.name]==null)return null;}}
for(var name in value){var item=this.getHeadByName(name);if(item==null){return null;}}
return value;};GridViewBTD.prototype.onSortColMouseUp=function(e){var elCellHead=this.getElCellHeader(e);if(elCellHead==null||!this.isAllowSortColumn||utilObj.isRightClick(e))return;if(elCellHead.head.item.sortType==SortType.noSort||this.isShowBtn||this.startResizeCol)return;var sortType=elCellHead.head.item.sortType;sortType=sortType==SortType.desc?SortType.asc:sortType==SortType.asc?SortType.none:SortType.desc;if(sortType==SortType.none){delete this.dicColumSort[elCellHead.head.item.name];}
this.onSortColumn(e,sortType);};GridViewBTD.prototype.getListSortInfo=function(){var re=[];for(var name in this.dicColumSort){if(!this.listMapHeader[name].item.isShow)continue;re.push(this.dicColumSort[name]);}
return re;};GridViewBTD.prototype.onSortColumn=function(e,sortType){if(this.elSortCellTHead==null)return;var item=this.elSortCellTHead.head.item;item.sortType=sortType;this.elSortCellTHead.elIconSort.className="sort "+sortType;if(sortType!=SortType.none){this.dicColumSort[item.name]={field:item.name,typeSort:sortType};}
else{delete this.dicColumSort[item.name];}
if(this.isAllowStoreCookie)this.setCookie();this.executeEventNormal(e,EventName.sort);};GridViewBTD.prototype.disposeMainMenu=function(){};GridViewBTD.prototype.createMainMenu=function(){var elDIV=utilObj.createEl("DIV");elDIV.className="mainMenuGV";elDIV.style.display="none";utilObj.addChildToBody(elDIV);var self=this;this.disposeMainMenu=function(){document.body.removeChild(elDIV);utilObj.removeEvent(window,"resize",onResize);utilObj.removeEvent(document,"scroll",onScroll);}
function onResize(){self.hideMainMenu();}
function onScroll(){self.hideMainMenu();}
utilObj.addEvent(window,"resize",onResize);utilObj.addEvent(document,"scroll",onScroll);this.elMainMenu=elDIV;var self=this;var listItemMM=new Object();listItemMM["ascCol"]={name:"Tăng dần",cssIcon:"asc",hasChildren:false,onClick:function(e,el){self.onSortColumn(e,SortType.asc);self.hideMenuColumn();},onMouseOver:function(e,el){},onMouseOut:function(e,el){self.toShowMC=setTimeout(function(){self.hideMenuColumn();},100);}};listItemMM["descCol"]={name:"Giảm dần",cssIcon:"desc",hasChildren:false,onClick:function(e,el){self.onSortColumn(e,SortType.desc);self.hideMenuColumn();},onMouseOver:function(e,el){},onMouseOut:function(e,el){self.toShowMC=setTimeout(function(){self.hideMenuColumn();},100);}};listItemMM["clearCol"]={name:"Bỏ sắp xếp",cssIcon:"noSort",hasChildren:false,onClick:function(e,el){self.onSortColumn(e,SortType.none);self.hideMenuColumn();},onMouseOver:function(e,el){},onMouseOut:function(e,el){self.toShowMC=setTimeout(function(){self.hideMenuColumn();},100);}};listItemMM["hideCol"]={name:"Cột",cssIcon:"columns",hasChildren:true,onClick:function(e,el){clearTimeout(self.toHideMC);clearTimeout(self.toShowSM);self.toShowMC=setTimeout(function(){self.showMenuColumn(e,el);},100);},onMouseOver:function(e,el){clearTimeout(self.toHideMC);clearTimeout(self.toShowSM);self.toShowMC=setTimeout(function(){self.showMenuColumn(e,el);},100);},onMouseOut:function(e,el){self.toHideMC=setTimeout(function(){self.hideMenuColumn()},100);}};listItemMM["filterCol"]={name:"Lọc cột",cssIcon:"filter",hasChildren:false,onClick:function(e,el){clearTimeout(self.toShowSM);clearTimeout(self.toShowMC);self.showFilterColumn();self.hideMainMenu();},onMouseOver:function(e,el){clearTimeout(self.toShowSM);clearTimeout(self.toShowMC);self.hideMenuColumn();},onMouseOut:function(e,el){clearTimeout(self.toShowSM);clearTimeout(self.toShowMC);self.hideMenuColumn();}};listItemMM["clearAllDataFilterCol"]={name:"Xóa dữ liệu đã lọc",cssIcon:"clearFilter",hasChildren:false,onClick:function(e,el){clearTimeout(self.toShowSM);clearTimeout(self.toShowMC);self.clearAllDataFilter();self.hideMainMenu();},onMouseOver:function(e,el){clearTimeout(self.toShowSM);clearTimeout(self.toShowMC);self.hideMenuColumn();},onMouseOut:function(e,el){clearTimeout(self.toShowSM);clearTimeout(self.toShowMC);self.hideMenuColumn();}};this.elMainMenu.listItem=listItemMM;if(this.isAllowSortColumn){this.createItemMainMenu(listItemMM["ascCol"]);this.createItemMainMenu(listItemMM["descCol"]);this.createItemMainMenu(listItemMM["clearCol"]);}
if(this.isAllowHideColumn){this.createItemMainMenu(listItemMM["hideCol"]);}
if(this.isAllowFilterColumn){this.createItemMainMenu(listItemMM["filterCol"]);this.createItemMainMenu(listItemMM["clearAllDataFilterCol"]);}};GridViewBTD.prototype.clearAllDataFilter=function(){for(var i=0;i<this.elFilterHeaderRow.cells.length;i++){var elCell=this.elFilterHeaderRow.cells[i];if(elCell.oHead!=null){elCell.oHead.filterValue=null;}
if(elCell.style.display=='none')continue;if(elCell.element!=null){var v='';var dataType=1;var operator=Operator.contains;switch(elCell.oHead.type){case ColummType.number:case ColummType.labelNumber:case ColummType.email:case ColummType.textBox:case ColummType.label:case ColummType.richText:case ColummType.textArea:case ColummType.hyperLink:elCell.element.value="";break;case ColummType.labelDate:case ColummType.date:case ColummType.labelDateTime:case ColummType.checkBox:case ColummType.labelCheckBox:case ColummType.tripleBox:case ColummType.radioBox:case ColummType.selectBox:case ColummType.labelSelectBox:case ColummType.labelEditSelectBox:case ColummType.multiSelectBox:case ColummType.labelMultiSelectBox:elCell.element.reset();break;case ColummType.color:elCell.element.reset();break;default:break;}}}
this.executeEventNormal({},EventName.filter);};GridViewBTD.prototype.showMainMenu=function(e,elParent){var c={X:0,Y:0};var el=elParent;while(el!=null&&el.tagName!='BODY'){c.X+=el.scrollLeft;c.Y+=el.scrollTop;el=el.parentNode;}
var pos=utilObj.coordsElChildByParentIntelligent(this.elMainMenu,elParent);var size=utilObj.getElementSize(elParent);this.elMainMenu.style.display="block";if(pos.posCase=="bottomRight"||pos.posCase=="topRight"){pos.X-=size.width;}
else if(pos.posCase=="bottomLeft"||pos.posCase=="topLeft"){pos.X+=size.width;}
this.elMainMenu.style.left=(pos.X-c.X)+"px";this.elMainMenu.style.top=(pos.Y-c.Y)+"px";};GridViewBTD.prototype.hideMainMenu=function(){this.isShowMenu=this.isShowBtn=false;if(this.elItemActiveMM!=null){this.elItemActiveMM.className=this.elItemActiveMM.item.hasChildren?"item hasChildren":"item";}
if(this.elBtnShowCol!=null){this.elBtnShowCol.style.display="none";}
if(this.elMainMenu!=null){this.elMainMenu.style.display="none";}};GridViewBTD.prototype.createItemMainMenu=function(item){var elA=utilObj.createEl("A");elA.item=item;item.element=elA;elA.className=item.hasChildren?"item hasChildren":"item";var elImg=utilObj.createEl("DIV");elImg.className="icon "+item.cssIcon;elA.appendChild(elImg);var elText=utilObj.createEl("LABEL");elText.innerHTML=item.name;elA.appendChild(elText);this.elMainMenu.appendChild(elA);var self=this;utilObj.addEvent(elA,"mouseover",function(e){if(self.elItemActiveMM!=null&&self.elItemActiveMM!=elA){self.hideMenuColumn();self.elItemActiveMM.className=self.elItemActiveMM.item.hasChildren?"item hasChildren":"item";}
self.elItemActiveMM=elA;elA.className=item.hasChildren?"item active hasChildren":"item active";if(item.onMouseOver!=null)item.onMouseOver(e,elA);});utilObj.addEvent(elA,"mouseout",function(e){self.elItemActiveMM=elA;elA.className=item.hasChildren?"item hasChildren":"item";if(item.onMouseOut!=null)item.onMouseOut();});utilObj.addEvent(elA,"click",function(e){self.elItemActiveMM=elA;elA.className=item.hasChildren?"item active hasChildren":"item active";if(item.onClick!=null)item.onClick(e,elA);});};GridViewBTD.prototype.hideColumnByName=function(name){this.hideColumn([this.getColumnIndex(name)]);}
GridViewBTD.prototype.hideColumn=function(columnIndexs){function hideRowColumn(rows){for(var i=0;i<rows.length;i++){for(var j=0;j<columnIndexs.length;j++){rows[i].cells[columnIndexs[j]].style.display="none";}}}
if(this.isShowAllPage){for(var i=1;i<=this.totalPage;i++){hideRowColumn(this.elContainerGV.cBody.dicTable["page-"+i].rows);}}
else{hideRowColumn(this.elContainerGV.cBody.table.rows);}
hideRowColumn(this.elContainerGV.cFooter.table.rows);hideRowColumn(this.elContainerGV.cHeader.table.rows);var total=0;for(var j=0;j<columnIndexs.length;j++){var elCell=this.elContainerGV.cHeader.table.rows[1].cells[columnIndexs[j]];if(elCell.head.item.isShow){total+=elCell.head.item.width;elCell.head.item.elCheckBoxMenuColumn.checked=elCell.head.item.isShow=false;}}
var totalW=this.gvWidth-total;this.gvWidth=totalW;this.elContainerGV.cHeader.table.style.width=totalW+'px';if(this.isShowAllPage){for(var i=1;i<=this.totalPage;i++){this.elContainerGV.cBody.dicTable["page-"+i].style.width=totalW+'px';}}
else{this.elContainerGV.cBody.table.style.width=totalW+'px';}
this.elContainerGV.cFooter.table.style.width=totalW+'px';var me=this;setTimeout(function(){me.calcHeightForAllPage();me.scrollLoadData();},10);};GridViewBTD.prototype.showColumnByName=function(name){this.showColumn([this.getColumnIndex(name)]);}
GridViewBTD.prototype.showColumn=function(columnIndexs){function showRowColumn(rows){for(var i=0;i<rows.length;i++){for(var j=0;j<columnIndexs.length;j++){rows[i].cells[columnIndexs[j]].style.display="";}}}
if(this.isShowAllPage){for(var i=1;i<=this.totalPage;i++){showRowColumn(this.elContainerGV.cBody.dicTable["page-"+i].rows);}}
else{showRowColumn(this.elContainerGV.cBody.table.rows);}
showRowColumn(this.elContainerGV.cFooter.table.rows);showRowColumn(this.elContainerGV.cHeader.table.rows);var total=0;for(var j=0;j<columnIndexs.length;j++){var elCell=this.elContainerGV.cHeader.table.rows[1].cells[columnIndexs[j]];if(elCell.head.item.isShow==false){total+=elCell.head.item.width;elCell.head.item.elCheckBoxMenuColumn.checked=elCell.head.item.isShow=true;}}
var totalW=this.gvWidth+total;this.gvWidth=totalW;this.elContainerGV.cHeader.table.style.width=totalW+'px';if(this.isShowAllPage){for(var i=1;i<=this.totalPage;i++){this.elContainerGV.cBody.dicTable["page-"+i].style.width=totalW+'px';}}
else{this.elContainerGV.cBody.table.style.width=totalW+'px';}
this.elContainerGV.cFooter.table.style.width=totalW+'px';var me=this;setTimeout(function(){me.calcHeightForAllPage();me.scrollLoadData();},10);};GridViewBTD.prototype.onItemMenuClick=function(e,el){var elTarget=utilObj.getTargetElement();if(elTarget.tagName.toUpperCase()=="A"){el.elCheckBox.checked=!el.elCheckBox.checked;}
if(el.elCheckBox.checked){this.showColumn([this.listMapHeader[el.item.name].elCell.cellIndex]);}
else{var count=0;for(var i=0;i<this.listMapHeader.length;i++){if(this.listMapHeader[i].elCell.style.display!="none"){count++;}}
if(count==1){el.elCheckBox.checked=true;return;}
this.hideColumn([this.listMapHeader[el.item.name].elCell.cellIndex]);}
if(this.isAllowStoreCookie)this.setCookie();this.executeEventNormal(e,EventName.showOrHideColumn);};GridViewBTD.prototype.createItemMenuColumn=function(item){var elA=utilObj.createEl("A");elA.item=item;elA.className="item";var elInput=utilObj.createEl("INPUT");item.elCheckBoxMenuColumn=elA.elCheckBox=elInput;elInput.type="CHECKBOX";elA.appendChild(elInput);elA.appendChild(utilObj.createElText(item.caption));this.elMenuColumn.appendChild(elA);elInput.checked=item.isShow;var self=this;utilObj.addEvent(elA,"mouseover",function(e){self.elItemActiveMM.className="item active hasChildren";});utilObj.addEvent(elA,"click",function(e){self.onItemMenuClick(e,elA);});};GridViewBTD.prototype.disposeMenuColumn=function(){};GridViewBTD.prototype.createMenuColumn=function(){var elDIV=utilObj.createEl("DIV");elDIV.className="menuColGV";elDIV.style.display="none";utilObj.addChildToBody(elDIV);var self=this;function hideMenu(e){self.hideMenuColumn();}
utilObj.addEvent(elDIV,"mouseover",function(e){self.isOverMenuColumn=true;});utilObj.addEvent(elDIV,"mouseout",function(e){self.isOverMenuColumn=false;});utilObj.addEvent(window,"resize",hideMenu);utilObj.addEvent(document,"scroll",hideMenu);this.elMenuColumn=elDIV;this.disposeMenuColumn=function(){utilObj.removeEvent(window,"resize",hideMenu);utilObj.removeEvent(document,"scroll",hideMenu);document.body.removeChild(elDIV);self.elMenuColumn=null;};};GridViewBTD.prototype.showMenuColumn=function(e,el){var pos=utilObj.coordsElChildByParentIntelligent(this.elMenuColumn,el);var size=utilObj.getElementSize(el);pos={X:pos.X-1,Y:pos.Y+1-size.height};this.elMenuColumn.style.display="block";this.elMenuColumn.style.left=pos.X+"px";this.elMenuColumn.style.top=pos.Y+"px";};GridViewBTD.prototype.hideMenuColumn=function(){if(this.isOverMenuColumn)return;this.isShowBtn=false;this.elMenuColumn.style.display="none";};GridViewBTD.prototype.onBtnMenuMouseOver=function(e,el){this.isShowBtn=true;};GridViewBTD.prototype.onBtnMenuMouseOut=function(e,el){if(this.isShowMenu)return;this.isShowBtn=false;el.style.display="none";};GridViewBTD.prototype.onBtnMenuClick=function(e,el){this.isShowMenu=true;this.showMainMenu(e,el);};GridViewBTD.prototype.createBtnShowCol=function(){var elA=utilObj.createEl("A");elA.className=this.cssBtnShowCol;elA.href="javascript:void(0)";elA.style.display="none";this.elContainerGV.appendChild(elA);this.elBtnShowCol=elA;var self=this;utilObj.addEvent(elA,"mouseover",function(e){self.onBtnMenuMouseOver(e,elA);});utilObj.addEvent(elA,"mouseout",function(e){self.onBtnMenuMouseOut(e,elA);});var eventName=utilObj.isSafari||utilObj.isFF?"click":"mousedown";utilObj.addEvent(elA,eventName,function(e){self.onBtnMenuClick(e,elA);});};GridViewBTD.prototype.onShowOrHideColMouseOver=function(e,el){if(this.startResizeCol)return;this.elSortCellTHead=el.parentNode;if(this.elSortCellTHead.head.item.sortType==SortType.noSort||!this.elSortCellTHead.head.item.isAllowHide)return;if(this.isAllowSortColumn){this.elMainMenu.listItem["clearCol"].element.style.display=this.elMainMenu.listItem["descCol"].element.style.display=this.elMainMenu.listItem["ascCol"].element.style.display=this.elSortCellTHead.head.item.sortType==SortType.noSort?"none":"";}
el.appendChild(this.elBtnShowCol);this.elBtnShowCol.style.display="block";this.elBtnShowCol.style.right=this.widthToResize+"px";this.elBtnShowCol.style.top="0px";if(this.isShowMenu){this.onBtnMenuClick(e,this.elBtnShowCol);if(this.elMenuColumn!=null&&this.elMenuColumn.style.display=="block"){this.showMenuColumn(e,this.elItemActiveMM);}
else if(this.elSortMenu!=null&&this.elSortMenu.style.display=="block"){this.showSortMenu(e,this.elItemActiveMM);}}};GridViewBTD.prototype.onShowOrHideColMouseOut=function(e,el){if(this.isShowMenu)return;this.elBtnShowCol.style.display="none";};GridViewBTD.prototype.onShowOrHideColMouseUp=function(e){var isHideMenu=true;var elTarget=utilObj.getTargetElement();while(elTarget!=null&&elTarget.className!=null){if((elTarget.className==this.cssBtnShowCol&&elTarget==this.elBtnShowCol)||(elTarget.className==this.cssHeaderTD&&elTarget.myName==this.myName)||elTarget==this.elMenuColumn||elTarget==this.elMainMenu){isHideMenu=false;utilObj.stopEvent();break;}
elTarget=elTarget.parentNode;}
if(isHideMenu){this.hideMainMenu();this.hideMenuColumn();}};GridViewBTD.prototype.showOrHideColumn=function(el){var self=this;utilObj.addEvent(el,"mouseover",function(e){self.onShowOrHideColMouseOver(e,el);});utilObj.addEvent(el,"mouseout",function(e){self.onShowOrHideColMouseOut(e,el);});};GridViewBTD.prototype.createElResizeDisplay=function(){var elResizeDisplay=utilObj.createEl("DIV");elResizeDisplay.style.display="none";elResizeDisplay.style.position="absolute";elResizeDisplay.style.width="2px";elResizeDisplay.style.backgroundColor="#ff7200";elResizeDisplay.style.zIndex=65000;utilObj.addChildToBody(elResizeDisplay);this.elResizeDisplay=elResizeDisplay;};GridViewBTD.prototype.getElCellHeader=function(e){var elTarget=utilObj.getTargetElement();while(elTarget!=null&&elTarget.className!=null){if(elTarget.className==this.cssHeaderTD&&elTarget.myName==this.myName){return elTarget;}
elTarget=elTarget.parentNode;}
return null;};GridViewBTD.prototype.onResizeColMouseMove=function(e){if(this.isShowMenu)return;if(this.startMoveCol)return;var elCell=this.getElCellHeader(e);e=utilObj.getWindowEvent();var mouseCoords=utilObj.mouseCoords(e);if(elCell!=null){if(!elCell.head.item.isAllowResize){this.canResize=false;elCell.parentNode.className=elCell.parentNode.className.replace(" wResize","");return;}
var elCellPos=utilObj.getElementPositionView(elCell);var elCellSize=utilObj.getElementSize(elCell);var coord=elCellPos.X+elCellSize.width;if(coord-this.widthToResize<=mouseCoords.X&&mouseCoords.X<=coord){this.canResize=true;if(elCell.parentNode.className.indexOf('wResize')==-1){elCell.parentNode.className+=" wResize";}}
else{this.canResize=false;if(!this.startResizeCol){elCell.parentNode.className=elCell.parentNode.className.replace(" wResize","");}}}
else{var row=this.elContainerGV.cHeader.table.rows[1];row.className=row.className.replace(" wResize","");}
if(this.startResizeCol){var detal=mouseCoords.X-this.mouseDownCoords.X;if(this.w+detal<10){return;}
var elContainerGVPos=utilObj.getElementPositionView(this.elContainerGV);$(this.elResizeDisplay).css({height:utilObj.getElementSize(this.elContainerGV).height,top:elContainerGVPos.Y,left:mouseCoords.X,display:''});}};GridViewBTD.prototype.setColumnWidth=function(colName,width){var cellIndex=this.getColumnIndex(colName);var cellResizing=this.elContainerGV.cHeader.table.rows[1].cells[cellIndex];this.w=cellResizing.head.item.width;if(width<30)return;var detal=width-this.w;this.changeColumnWidthByCell(cellResizing,detal);this.gvWidth=parseInt(this.elContainerGV.cHeader.table.style.width,10);};GridViewBTD.prototype.setWidthGrid=function(width){var wDetal=parseInt(width-this.gvWidth-18,10);var lengthReal=0;var lastHead=null;for(var i=0;i<this.configData.head.length;i++){var iHead=this.configData.head[i];if(iHead.isShow){if(iHead.isFullWidth){lengthReal++;}
lastHead=iHead;}}
if(lengthReal==0){this.setColumnWidth(lastHead.name,lastHead.width+wDetal);}
else{wDetal=parseInt(wDetal/lengthReal,10);for(var i=0;i<this.configData.head.length;i++){var iHead=this.configData.head[i];if(iHead.isShow&&iHead.isFullWidth){this.setColumnWidth(iHead.name,iHead.width+wDetal);}}}
this.configData.widthGrid=width;this.updateWidthContainer();};GridViewBTD.prototype.changeColumnWidthByCell=function(cellResizing,detal){var totalW=this.gvWidth+detal;this.elContainerGV.cHeader.table.style.width=totalW+'px';if(this.isShowAllPage){for(var i=1;i<=this.totalPage;i++){this.elContainerGV.cBody.dicTable["page-"+i].style.width=totalW+'px';}}
else{this.elContainerGV.cBody.table.style.width=totalW+'px';}
this.elContainerGV.cFooter.table.style.width=totalW+'px';var cellW=this.w+detal;this.elContainerGV.cHeader.table.rows[0].cells[cellResizing.cellIndex].style.width=cellW+"px";if(this.isShowAllPage){for(var i=1;i<=this.totalPage;i++){this.elContainerGV.cBody.dicTable["page-"+i].rows[0].cells[cellResizing.cellIndex].style.width=cellW+"px";}}
else{this.elContainerGV.cBody.table.rows[0].cells[cellResizing.cellIndex].style.width=cellW+"px";}
this.elContainerGV.cFooter.table.rows[0].cells[cellResizing.cellIndex].style.width=cellW+"px";cellResizing.head.item.width=cellW;};GridViewBTD.prototype.onResizeColMouseDown=function(e){e=utilObj.getWindowEvent();if(utilObj.isRightClick(e))return;var elCell=this.getElCellHeader();if(elCell==null||!this.canResize||elCell.isFunctionGV!=null)return;this.elCellResizing=elCell;this.startResizeCol=true;this.mouseDownCoords=utilObj.mouseCoords(e);this.w=this.elCellResizing.head.item.width;utilObj.disableSelection(document.body);utilObj.stopEvent();};GridViewBTD.prototype.onResizeColMouseUp=function(e){if(!this.startResizeCol)return;this.startResizeCol=false;var row=this.elContainerGV.cHeader.table.rows[0];row.className=row.className.replace(" wResize","");var detal=$(this.elResizeDisplay).position().left-this.mouseDownCoords.X;$(this.elResizeDisplay).css({display:'none'});this.changeColumnWidthByCell(this.elCellResizing,detal);this.elCellResizing=null;this.gvWidth=parseInt(this.elContainerGV.cHeader.table.style.width,10);utilObj.enableSelection(document.body);if(this.isAllowStoreCookie)this.setCookie();};GridViewBTD.prototype.createIconMoveColumn=function(){var elDiv=utilObj.createEl("DIV");elDiv.className="iconMoveColumnGV";elDiv.style.display="none";utilObj.addChildToBody(elDiv);this.elIconMoveColumn=elDiv;};GridViewBTD.prototype.showIconMoveColumn=function(oPos){var elIconCol=this.elIconMoveColumn;elIconCol.style.display="";elIconCol.style.left=oPos.X+"px";elIconCol.style.top=(oPos.Y-9)+"px";};GridViewBTD.prototype.hideIconMoveColumn=function(){this.elIconMoveColumn.style.display="none";};GridViewBTD.prototype.createMoveColumn=function(){var elDiv=utilObj.createEl("DIV");elDiv.className="moveColumnGV";elDiv.style.display="none";utilObj.addChildToBody(elDiv);this.elMoveColumn=elDiv;};GridViewBTD.prototype.showMoveColumn=function(){var elCol=this.elMoveColumn;var oPos=utilObj.getElementPositionView(this.elCellMoving);var oSize=utilObj.getElementSize(this.elCellMoving);this.detalCoord={X:this.mouseDownCoords.X-oPos.X,Y:this.mouseDownCoords.Y-oPos.Y};elCol.innerHTML=this.elCellMoving.firstChild.innerHTML;elCol.style.display="none";elCol.style.left=oPos.X+"px";elCol.style.top=oPos.Y+"px";elCol.style.width=(oSize.width-this.widthToResize-8)+"px";elCol.style.height=(oSize.height-8)+"px";};GridViewBTD.prototype.hideMoveColumn=function(){this.elMoveColumn.style.display="none";};GridViewBTD.prototype.onMoveColMouseDown=function(e){e=utilObj.getWindowEvent();if(utilObj.isRightClick(e))return;var elCell=this.getElCellHeader();if(elCell==null||this.canResize||elCell.isFunctionGV!=null)return;this.startMoveCol=true;this.elCellMoving=elCell;this.mouseDownCoords=utilObj.mouseCoords(e);this.showMoveColumn();utilObj.disableSelection(document.body);utilObj.stopEvent();};GridViewBTD.prototype.onMoveColMouseMove=function(e){if(this.isShowMenu)return;if(this.startResizeCol)return;e=utilObj.getWindowEvent();var mouseCoords=utilObj.mouseCoords(e);if(this.startMoveCol){this.elMoveColumn.style.display="";this.elMoveColumn.style.left=(mouseCoords.X-this.detalCoord.X)+"px";this.elMoveColumn.style.top=(mouseCoords.Y-this.detalCoord.Y)+"px";for(var i=0;i<this.listMapHeader.length;i++){var elCell=this.listMapHeader[i].elCell;if(this.elCellMoving!=elCell&&elCell.style.display!="none"){var elCellPos=utilObj.getElementPositionView(elCell);var elCellSize=utilObj.getElementSize(elCell);var start={X:elCellPos.X,Y:elCellPos.Y};var mid={X:elCellPos.X+(elCellSize.width/2),Y:elCellPos.Y};var end={X:elCellPos.X+elCellSize.width,Y:elCellPos.Y};if(start.Y<=mouseCoords.Y&&mouseCoords.Y<end.Y+elCellSize.height){if(start.X<=mouseCoords.X&&mouseCoords.X<mid.X){this.canMove=true;this.elCellNeedMove=elCell;this.showIconMoveColumn(start);break;}
else if(mid.X<=mouseCoords.X&&mouseCoords.X<end.X){this.canMove=true;this.elCellNeedMove=elCell.nextSibling;this.showIconMoveColumn(end);break;}
else{this.canMove=false;this.hideIconMoveColumn();}}
else{this.canMove=false;this.hideIconMoveColumn();}}
else{this.canMove=false;this.hideIconMoveColumn();}}}};GridViewBTD.prototype.onMoveColMouseUp=function(e){if(!this.startMoveCol)return;this.startMoveCol=false;this.hideMoveColumn();if(!this.canMove)return;this.canMove=false;var me=this;this.hideIconMoveColumn();utilObj.enableSelection(document.body);function changeBodyColumn(rows){var isTypeRichText=me.elCellMoving.head.item.type==ColummType.richText;for(var i=0;i<rows.length;i++){var elCells=rows[i].cells;if(i==0){rows[i].insertBefore(elCells[me.elCellMoving.cellIndex],elCells[me.elCellNeedMove.cellIndex]);}
else{var content="";var elRichText=null;if(isTypeRichText){elRichText=elCells[me.elCellMoving.cellIndex].element;content=elRichText.getContent();}
rows[i].insertBefore(elCells[me.elCellMoving.cellIndex],elCells[me.elCellNeedMove.cellIndex]);if(isTypeRichText){elRichText.iframeInit(content);}}}}
if(this.isShowAllPage){for(var i=1;i<=this.totalPage;i++){changeBodyColumn(this.elContainerGV.cBody.dicTable["page-"+i].rows);}}
else{changeBodyColumn(this.elContainerGV.cBody.table.rows);}
rows=this.elContainerGV.cFooter.table.rows;for(var i=0;i<rows.length;i++){var elCells=rows[i].cells;rows[i].insertBefore(elCells[this.elCellMoving.cellIndex],elCells[this.elCellNeedMove.cellIndex]);}
this.changeHeaderColumn();this.elCellMoving=this.elCellNeedMove=null;if(this.isAllowStoreCookie)this.setCookie();};GridViewBTD.prototype.moveColumn=function(){this.createMoveColumn();this.createIconMoveColumn();};GridViewBTD.prototype.changeHeaderColumn=function(){var headMoving=this.elCellMoving.head;var headNeedMove=this.elCellNeedMove.head;var cellNeedMoveIndex=this.isAllowSelectRow?this.elCellNeedMove.cellIndex-1:this.elCellNeedMove.cellIndex;this.listMapHeader.splice(cellNeedMoveIndex,0,headMoving);var detal=this.elCellMoving.cellIndex>this.elCellNeedMove.cellIndex?1:0;var cellMovingIndex=this.isAllowSelectRow?this.elCellMoving.cellIndex-1:this.elCellMoving.cellIndex;this.listMapHeader.splice(cellMovingIndex+detal,1);rows=this.elContainerGV.cHeader.table.rows;cellNeedMoveIndex=this.elCellNeedMove.cellIndex;cellMovingIndex=this.elCellMoving.cellIndex;for(var i=0;i<rows.length;i++){var elCells=rows[i].cells;rows[i].insertBefore(elCells[cellMovingIndex],elCells[cellNeedMoveIndex]);}};GridViewBTD.prototype.setStyleRow=function(elCheckBox){var elRow=elCheckBox.parentNode.parentNode;if(elCheckBox.checked){elRow.className=elRow.className.replace("bgColor","");elRow.className=elRow.className.replace("alternatingBgColor","");if(elRow.className.indexOf("selectionBgColor",0)==-1){elRow.className+=" selectionBgColor";}}
else{elRow.className=elRow.className.replace("selectionBgColor","");if((elRow.rowIndex%2!=0)&&(elRow.className.indexOf("bgColor",0)==-1))
{elRow.className+=" bgColor";}
else if((elRow.rowIndex%2==0)&&(elRow.className.indexOf("alternatingBgColor",0)==-1))
{elRow.className+=" alternatingBgColor";}}};GridViewBTD.prototype.changeStatusSelectAllRow=function(){var me=this;function changeStatusRow(rows){for(var i=1;i<rows.length;i++){rows[i].cells[0].element.checked=me.elSelectionAll.checked;me.setStyleRow(rows[i].cells[0].element);}}
if(this.isShowAllPage){for(var key in this.elContainerGV.cBody.dicTable){changeStatusRow(this.elContainerGV.cBody.dicTable[key].rows);}}
else{changeStatusRow(this.elContainerGV.cBody.table.rows);}};GridViewBTD.prototype.createElCellSelectAllRow=function(elRow){var elCell=elRow.insertCell(elRow.cells.length);elCell.isFunctionGV=true;elCell.style.textAlign="center";elCell.element=utilObj.createEl("INPUT");elCell.element.type="CHECKBOX";elCell.element.title="Tất cả";elCell.element.style.padding=elCell.element.style.margin="0px";this.elSelectionAll=elCell.element;elCell.appendChild(elCell.element);var self=this;utilObj.addEvent(elCell.element,"click",function(e){self.changeStatusSelectAllRow();});};GridViewBTD.prototype.setRowsSelected=function(values,fieldValue){if(!this.isAllowSelectRow||this.elContainerGV==null)return;values=utilObj.convertArrayToDictionary(values);var me=this;function changeStatusRow(rows){var count=0;for(var i=1;i<rows.length;i++){if(values[rows[i].item[fieldValue]]!=null){rows[i].cells[0].element.checked=true;me.setStyleRow(rows[i].cells[0].element);}
if(rows[i].cells[0].element.checked){count++;}}
return count;}
if(this.isShowAllPage){var c=0;for(var key in this.elContainerGV.cBody.dicTable){c+=changeStatusRow(this.elContainerGV.cBody.dicTable[key].rows);}
this.elSelectionAll.checked=(c==this.totalRecord);}
else{var rows=this.elContainerGV.cBody.table.rows;var c=changeStatusRow(rows);this.elSelectionAll.checked=(c==(rows.length-1));}};GridViewBTD.prototype.unSelectRowsSelected=function(){if(!this.isAllowSelectRow||this.elContainerGV==null)return;var me=this;function changeStatusRow(rows){for(var i=1;i<rows.length;i++){rows[i].cells[0].element.checked=false;me.setStyleRow(rows[i].cells[0].element);}}
if(this.isShowAllPage){for(var key in this.elContainerGV.cBody.dicTable){changeStatusRow(this.elContainerGV.cBody.dicTable[key].rows);}}
else{changeStatusRow(this.elContainerGV.cBody.table.rows);}
this.elSelectionAll.checked=false;};GridViewBTD.prototype.getRowsSelected=function(){var arr=[];if(!this.isAllowSelectRow||this.elContainerGV==null)return arr;var me=this;function addRowSelected(rows){for(var i=1;i<rows.length;i++){if(rows[i].cells[0].element.checked){arr.push(rows[i]);}}}
if(this.isShowAllPage){for(var key in this.elContainerGV.cBody.dicTable){addRowSelected(this.elContainerGV.cBody.dicTable[key].rows);}}
else{addRowSelected(this.elContainerGV.cBody.table.rows);}
return arr;};GridViewBTD.prototype.changeStatusSelectRow=function(el){this.setStyleRow(el);function checkRowSelected(rows){var isAll=true;for(var i=1;i<rows.length;i++){if(!rows[i].cells[0].element.checked){isAll=false;break;}}
return isAll;}
var isAll=true;if(this.isShowAllPage){for(var key in this.elContainerGV.cBody.dicTable){isAll=checkRowSelected(this.elContainerGV.cBody.dicTable[key].rows);if(!isAll)break;}}
else{isAll=checkRowSelected(this.elContainerGV.cBody.table.rows);}
this.elSelectionAll.checked=isAll;};GridViewBTD.prototype.getAllRow=function(){var listRow=[];if(this.isShowAllPage){for(var key in this.elContainerGV.cBody.dicTable){for(var i=1;i<this.elContainerGV.cBody.dicTable[key].rows.length;i++){listRow.push(this.elContainerGV.cBody.dicTable[key].rows[i]);}}}
else{for(var i=1;i<this.elContainerGV.cBody.table.rows.length;i++){listRow.push(this.elContainerGV.cBody.table.rows[i]);}}
return listRow;};GridViewBTD.prototype.createElCellSelectRow=function(elRow){if(!this.isAllowSelectRow)return;var elCell=elRow.insertCell(elRow.cells.length);elCell.isFunctionGV=true;elCell.element=utilObj.createEl("INPUT");elCell.style.textAlign="center";elCell.element.type="CHECKBOX";elCell.element.style.padding=elCell.element.style.margin="0px";elCell.appendChild(elCell.element);var self=this;utilObj.addEvent(elCell.element,"click",function(e){self.changeStatusSelectRow(elCell.element);});return elCell;};GridViewBTD.prototype.onMultiSelectRowMouseDown=function(e){e=utilObj.getWindowEvent();if(utilObj.isRightClick(e))return;var me=this;function GetRowStartSelection(e){var elTarget=utilObj.getTargetElement();while(elTarget!=null&&elTarget.className!=null){if((elTarget.className.indexOf('bgColor')>-1||elTarget.className.indexOf('alternatingBgColor')>-1||elTarget.className.indexOf('selectionBgColor')>-1)&&elTarget.myName==me.myName){return elTarget;}
elTarget=elTarget.parentNode;}
return null;}
var elRowStartSelection=GetRowStartSelection(e);if(elRowStartSelection==null)return;if(this.elRowStartSelection!=null&&e.shiftKey){utilObj.disableSelection(document.body);var startIndex=elRowStartSelection.rowIndex;while(true){var elCheck=this.elContainerGV.cBody.table.rows[startIndex].cells[0].element;elCheck.checked=true;this.setStyleRow(elCheck);if(this.elRowStartSelection.rowIndex==startIndex){utilObj.enableSelection(document.body);break;}
else{startIndex=this.elRowStartSelection.rowIndex>startIndex?startIndex+1:startIndex-1;}}
utilObj.stopEvent();}
this.elRowStartSelection=elRowStartSelection;};GridViewBTD.prototype.getFilterCondition=function(){var re=[];for(var i=0;i<this.elFilterHeaderRow.cells.length;i++){var elCell=this.elFilterHeaderRow.cells[i];if(elCell.style.display=='none')continue;if(elCell.element!=null){var v='';var dataType=1;var operator=Operator.contains;switch(elCell.oHead.type){case ColummType.number:case ColummType.labelNumber:if(elCell.oHead.filterValue!=null&&typeof(elCell.oHead.filterValue)=='object'&&elCell.oHead.filterValue.operator1!=null){var itemFilter={field:elCell.oHead.name,dataType:2,operator:elCell.oHead.filterValue.operator1,value:elCell.oHead.filterValue.value1,isAnd:true};re.push(itemFilter);if(elCell.oHead.filterValue.operator2!=null){itemFilter={field:elCell.oHead.name,dataType:2,operator:elCell.oHead.filterValue.operator2,value:elCell.oHead.filterValue.value2,isAnd:elCell.oHead.filterValue.isAnd};re.push(itemFilter);}
continue;}
else{elCell.oHead.filterValue=v=elCell.element.value.trim();dataType=2;operator=Operator.equal;}
break;case ColummType.email:case ColummType.textBox:case ColummType.label:case ColummType.richText:case ColummType.textArea:case ColummType.hyperLink:elCell.oHead.filterValue=v=elCell.element.value.trim();break;case ColummType.labelDate:case ColummType.date:case ColummType.labelDateTime:if(elCell.oHead.filterValue!=null&&typeof(elCell.oHead.filterValue)=='object'){if(elCell.oHead.filterValue.value1==null)continue;var itemFilter={field:elCell.oHead.name,dataType:3,operator:elCell.oHead.filterValue.operator1,value:JSON.stringify(elCell.oHead.filterValue.value1),isAnd:true};if(elCell.oHead.listFieldFilter!=null){itemFilter.listField=elCell.oHead.listFieldFilter;}
re.push(itemFilter);if(elCell.oHead.filterValue.operator2!=null){itemFilter={field:elCell.oHead.name,dataType:3,operator:elCell.oHead.filterValue.operator2,value:JSON.stringify(elCell.oHead.filterValue.value2),isAnd:elCell.oHead.filterValue.isAnd};if(elCell.oHead.listFieldFilter!=null){itemFilter.listField=elCell.oHead.listFieldFilter;}
re.push(itemFilter);}
continue;}
else{elCell.oHead.filterValue=elCell.element.getDate();v=JSON.stringify(elCell.oHead.filterValue);operator=Operator.equal;dataType=3;}
break;case ColummType.checkBox:case ColummType.labelCheckBox:case ColummType.tripleBox:v=elCell.oHead.filterValue=''+elCell.element.getValue();operator=Operator.equal;dataType=12;break;case ColummType.radioBox:case ColummType.selectBox:case ColummType.labelSelectBox:case ColummType.labelEditSelectBox:case ColummType.multiSelectBox:case ColummType.labelMultiSelectBox:v=elCell.oHead.filterValue=elCell.element.getValue(elCell.oHead.dataMSB.useQuote);operator=Operator.moreValue;dataType=10;break;case ColummType.color:v=elCell.oHead.filterValue=elCell.element.getValue(elCell.oHead.dataMSB.useQuote);operator=Operator.moreValueColor;dataType=10;break;default:break;}
if(v!=null&&v!=''&&v!='null'&&v!=-1){var itemFilter={field:elCell.oHead.name,dataType:dataType,operator:operator,value:v,isAnd:true};if(elCell.oHead.listFieldFilter!=null){itemFilter.listField=elCell.oHead.listFieldFilter;}
if(elCell.oHead.sql!=null&&elCell.oHead.sql!=''){itemFilter.sql=elCell.oHead.sql;}
re.push(itemFilter);}
else{elCell.oHead.filterValue=null;}}}
return re;};GridViewBTD.prototype.showFilterColumn=function(){if(this.isShowFilterHeaderRow){this.elFilterHeaderRow.style.display='none';this.isShowFilterHeaderRow=false;}
else{this.elFilterHeaderRow.style.display='';this.isShowFilterHeaderRow=true;}};GridViewBTD.prototype.createTextBoxFilter=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=utilObj.createEl("INPUT");elCell.element.type="text";elCell.element.style.width="100%";elCell.element.className="inputText";if(oHead.filterValue!=null&&oHead.filterValue.trim()!=''){elCell.element.value=oHead.filterValue;}
elCell.appendChild(elCell.element);var me=this;utilObj.addEvent(elCell.element,EventName.keyDown,function(e){if(e.keyCode==13){me.executeEventNormal(e,EventName.filter);}});};GridViewBTD.prototype.showPopupNumberFilter=function(elCell,oHead){var me=this;if(this.elContainerPopupNumberFilter==null){var configDataOperator={textSeparator:', ',textPlaceholder:'Chọn toán tử',maxItem:10,mapField:{value:"operatorID",text:"name",checked:"",search:["name"],display:[{field:"name",type:ColummTypeDDL.label}]},data:[{operatorID:1,name:'='},{operatorID:2,name:'>'},{operatorID:3,name:'<'},{operatorID:4,name:'>='},{operatorID:5,name:'<='},{operatorID:8,name:'Khác'}]};var elContainerPopupNumberFilter=document.createElement('DIV');elContainerPopupNumberFilter.className="cPopupFilterBTD";document.body.appendChild(elContainerPopupNumberFilter);this.elContainerPopupNumberFilter=elContainerPopupNumberFilter;var elFieldset=document.createElement('fieldset');elContainerPopupNumberFilter.appendChild(elFieldset);var elLegend=document.createElement('legend');elFieldset.appendChild(elLegend);this.elContainerPopupNumberFilter.elLegend=elLegend;var elTable=document.createElement('table');elFieldset.appendChild(elTable);this.elContainerPopupNumberFilter.elTable=elTable;var r=elTable.insertRow(0);var c=r.insertCell(0);elContainerPopupNumberFilter.oDdlOperator1=new DropDownListBTD(c,configDataOperator,'ddlOperator1Filter'+this.myName);c=r.insertCell(1);c.element=utilObj.createEl("INPUT");c.element.type="text";c.element.style.width="100%";c.element.className="inputText";c.element.placeholder='Nhập giá trị';c.appendChild(c.element);elContainerPopupNumberFilter.elValue1=c.element;utilObj.numeric(elContainerPopupNumberFilter.elValue1);r=elTable.insertRow(1);c=r.insertCell(0);c.style.textAlign='center';c.colSpan=2;c.elementAnd=utilObj.createEl("INPUT");c.elementAnd.type="radio";c.elementAnd.checked=true;c.elementAnd.name="radioAndOrNumberFilter"+this.myName;c.elementAnd.id="radioAndNumberFilter"+this.myName;c.appendChild(c.elementAnd);elContainerPopupNumberFilter.elementAnd=c.elementAnd;var label=utilObj.createEl("label");label.htmlFor=c.elementAnd.id;label.innerHTML=' Và';c.appendChild(label);c.elementOr=utilObj.createEl("INPUT");c.elementOr.type="radio";c.elementOr.name="radioAndOrNumberFilter"+this.myName;c.elementOr.id="radioOrNumberFilter"+this.myName;c.appendChild(c.elementOr);elContainerPopupNumberFilter.elementOr=c.elementOr;var label=utilObj.createEl("label");label.htmlFor=c.elementOr.id;label.innerHTML=' Hoặc';c.appendChild(label);r=elTable.insertRow(2);c=r.insertCell(0);elContainerPopupNumberFilter.oDdlOperator2=new DropDownListBTD(c,configDataOperator,'ddlOperator2Filter'+this.myName);c=r.insertCell(1);c.element=utilObj.createEl("INPUT");c.element.type="text";c.element.style.width="100%";c.element.className="inputText";c.element.placeholder='Nhập giá trị';c.appendChild(c.element);elContainerPopupNumberFilter.elValue2=c.element;utilObj.numeric(elContainerPopupNumberFilter.elValue2);var elContainerBtn=document.createElement('DIV');elContainerBtn.className='cBtnFilter';elContainerPopupNumberFilter.appendChild(elContainerBtn);var elBtnOk=document.createElement('button');elBtnOk.innerHTML='Ok';elContainerBtn.appendChild(elBtnOk);this.elContainerPopupNumberFilter.elBtnOk=elBtnOk;var elBtnCancel=document.createElement('button');elBtnCancel.innerHTML='Hủy';elContainerBtn.appendChild(elBtnCancel);this.elContainerPopupNumberFilter.elBtnCancel=elBtnCancel;utilObj.addEvent(elBtnCancel,EventName.click,function(e){me.oPopupNumberFilter.hide();});this.oPopupNumberFilter=new ModalPopup(elContainerPopupNumberFilter,'Lộc dữ liệu');}
function getValue(){var data={operator1:me.elContainerPopupNumberFilter.oDdlOperator1.getValue(),value1:me.elContainerPopupNumberFilter.elValue1.value.replace(/\./gi,''),isAnd:me.elContainerPopupNumberFilter.elementAnd.checked,operator2:me.elContainerPopupNumberFilter.oDdlOperator2.getValue(),value2:me.elContainerPopupNumberFilter.elValue2.value.replace(/\./gi,'')};if(data.operator1!=null&&data.value1==''){alert("Bạn phải chọn toán tử thứ 1");return null;}
if(data.operator2!=null&&data.value2==''){alert("Bạn phải chọn toán tử thứ 2");return null;}
return data;}
function setValue(){if(oHead.filterValue==null||typeof(oHead.filterValue)=='string'){me.elContainerPopupNumberFilter.oDdlOperator1.reset();me.elContainerPopupNumberFilter.oDdlOperator2.reset();me.elContainerPopupNumberFilter.elementAnd.checked=true;me.elContainerPopupNumberFilter.elValue1.value=me.elContainerPopupNumberFilter.elValue2.value='';return;}
me.elContainerPopupNumberFilter.oDdlOperator1.selectedValue(oHead.filterValue.operator1);if(oHead.filterValue.operator2!=null){me.elContainerPopupNumberFilter.oDdlOperator2.selectedValue(oHead.filterValue.operator2);}
if(oHead.filterValue.isAnd){me.elContainerPopupNumberFilter.elementAnd.checked=true;}
else{me.elContainerPopupNumberFilter.elementOr.checked=true;}
if(oHead.filterValue.value1!=null){me.elContainerPopupNumberFilter.elValue1.value=utilObj.formatNumber(oHead.filterValue.value1,'.');}
if(oHead.filterValue.value2!=null){me.elContainerPopupNumberFilter.elValue2.value=utilObj.formatNumber(oHead.filterValue.value2,'.');}}
this.oPopupNumberFilter.display();this.elContainerPopupNumberFilter.elLegend.innerHTML=oHead.caption;setValue();this.elContainerPopupNumberFilter.elBtnOk.onclick=function(e){oHead.filterValue=getValue();if(oHead.filterValue==null){return;}
me.oPopupNumberFilter.hide();me.executeEventNormal(e,EventName.filter);};};GridViewBTD.prototype.createNumberFilter=function(elCell,oHead){var me=this;var elTable=document.createElement('TABLE');elTable.className="numberFilterBTD";elTable.border=0;elCell.appendChild(elTable);var r=elTable.insertRow(0);var c=r.insertCell(0);var elRow=elCell.parentNode;elCell.element=utilObj.createEl("INPUT");elCell.element.type="text";elCell.element.style.width="100%";elCell.element.className="inputText";if(oHead.filterValue!=null&&oHead.filterValue!=''&&typeof(getValue)=='string'){elCell.element.value=oHead.filterValue;}
c.appendChild(elCell.element);c=r.insertCell(1);var btnFilter=document.createElement('DIV');btnFilter.className='btnFilterBTD';c.appendChild(btnFilter);utilObj.addEvent(btnFilter,EventName.click,function(e){me.showPopupNumberFilter(elCell,oHead);});utilObj.addEvent(elCell.element,EventName.keyDown,function(e){if(e.keyCode==13){me.executeEventNormal(e,EventName.filter);}});};GridViewBTD.prototype.createTripleBoxFilter=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=new TripleBoxBTD(elCell);elCell.element.init();if(oHead.filterValue!=null){elCell.element.setValue(oHead.filterValue);}
var me=this;elCell.element.addEvent(EventNameTB.change,function(e){me.executeEventNormal(e,EventName.filter);});};GridViewBTD.prototype.createMultiSelectBoxFilter=function(elCell,oHead){var elRow=elCell.parentNode;var t=(new Date()).getTime();elCell.element=new MultiSelectBoxBTD(elCell,oHead.dataMSB,"oMSB"+this.myName+oHead.name+t+''+elRow.rowIndex);elCell.element.setWidth("100%");if(oHead.filterValue!=null){elCell.element.selectedValues(utilObj.convertArrayToDictionary(oHead.filterValue.split(',')),oHead.dataMSB.useQuote);}
var me=this;elCell.element.addEvent(EventNameMSB.ok,function(e){elCell.element.hideList();me.executeEventNormal(e,EventName.filter);});};GridViewBTD.prototype.showPopupDateFilter=function(elCell,oHead){var me=this;if(this.elContainerPopupDateFilter==null){var configDataOperator={textSeparator:', ',textPlaceholder:'Chọn toán tử',maxItem:10,mapField:{value:"operatorID",text:"name",checked:"",search:["name"],display:[{field:"name",type:ColummTypeDDL.label}]},data:[{operatorID:1,name:'='},{operatorID:2,name:'>'},{operatorID:3,name:'<'},{operatorID:4,name:'>='},{operatorID:5,name:'<='},{operatorID:8,name:'Khác'}]};var elContainerPopupDateFilter=document.createElement('DIV');elContainerPopupDateFilter.className="cPopupFilterBTD";document.body.appendChild(elContainerPopupDateFilter);this.elContainerPopupDateFilter=elContainerPopupDateFilter;var elFieldset=document.createElement('fieldset');elContainerPopupDateFilter.appendChild(elFieldset);var elLegend=document.createElement('legend');elFieldset.appendChild(elLegend);this.elContainerPopupDateFilter.elLegend=elLegend;var elTable=document.createElement('table');elFieldset.appendChild(elTable);this.elContainerPopupDateFilter.elTable=elTable;var r=elTable.insertRow(0);var c=r.insertCell(0);elContainerPopupDateFilter.oDdlOperator1=new DropDownListBTD(c,configDataOperator,'ddlOperator1Filter'+this.myName);c=r.insertCell(1);elContainerPopupDateFilter.elValue1=new CalendarBTD(c,"elCalendar1FilterBTD"+this.myName,"",false);r=elTable.insertRow(1);c=r.insertCell(0);c.style.textAlign='center';c.colSpan=2;c.elementAnd=utilObj.createEl("INPUT");c.elementAnd.type="radio";c.elementAnd.checked=true;c.elementAnd.name="radioAndOrDateFilter"+this.myName;c.elementAnd.id="radioAndDateFilter"+this.myName;c.appendChild(c.elementAnd);elContainerPopupDateFilter.elementAnd=c.elementAnd;var label=utilObj.createEl("label");label.htmlFor=c.elementAnd.id;label.innerHTML=' Và';c.appendChild(label);c.elementOr=utilObj.createEl("INPUT");c.elementOr.type="radio";c.elementOr.name="radioAndOrDateFilter"+this.myName;c.elementOr.id="radioOrDateFilter"+this.myName;c.appendChild(c.elementOr);elContainerPopupDateFilter.elementOr=c.elementOr;var label=utilObj.createEl("label");label.htmlFor=c.elementOr.id;label.innerHTML=' Hoặc';c.appendChild(label);r=elTable.insertRow(2);c=r.insertCell(0);elContainerPopupDateFilter.oDdlOperator2=new DropDownListBTD(c,configDataOperator,'ddlOperator2Filter'+this.myName);c=r.insertCell(1);elContainerPopupDateFilter.elValue2=new CalendarBTD(c,"elCalendar2FilterBTD"+this.myName,"",false);var elContainerBtn=document.createElement('DIV');elContainerBtn.className='cBtnFilter';elContainerPopupDateFilter.appendChild(elContainerBtn);var elBtnOk=document.createElement('button');elBtnOk.innerHTML='Ok';elContainerBtn.appendChild(elBtnOk);this.elContainerPopupDateFilter.elBtnOk=elBtnOk;var elBtnCancel=document.createElement('button');elBtnCancel.innerHTML='Hủy';elContainerBtn.appendChild(elBtnCancel);this.elContainerPopupDateFilter.elBtnCancel=elBtnCancel;utilObj.addEvent(elBtnCancel,EventName.click,function(e){me.oPopupDateFilter.hide();});this.oPopupDateFilter=new ModalPopup(elContainerPopupDateFilter,'Lộc dữ liệu');}
function getValue(){var data={operator1:me.elContainerPopupDateFilter.oDdlOperator1.getValue(),value1:me.elContainerPopupDateFilter.elValue1.getDate(),isAnd:me.elContainerPopupDateFilter.elementAnd.checked,operator2:me.elContainerPopupDateFilter.oDdlOperator2.getValue(),value2:me.elContainerPopupDateFilter.elValue2.getDate()};if(data.operator1!=null&&data.value1==null){alert("Bạn phải chọn toán tử thứ 1");return null;}
if(data.operator2!=null&&data.value2==null){alert("Bạn phải chọn toán tử thứ 2");return null;}
return data;}
function setValue(){if(oHead.filterValue==null||typeof(oHead.filterValue)=='string'){me.elContainerPopupDateFilter.oDdlOperator1.reset();me.elContainerPopupDateFilter.oDdlOperator2.reset();me.elContainerPopupDateFilter.elementAnd.checked=true;me.elContainerPopupDateFilter.elValue1.reset();me.elContainerPopupDateFilter.elValue2.reset();return;}
me.elContainerPopupDateFilter.oDdlOperator1.selectedValue(oHead.filterValue.operator1);if(oHead.filterValue.operator2!=null){me.elContainerPopupDateFilter.oDdlOperator2.selectedValue(oHead.filterValue.operator2);}
if(oHead.filterValue.isAnd){me.elContainerPopupDateFilter.elementAnd.checked=true;}
else{me.elContainerPopupDateFilter.elementOr.checked=true;}
if(oHead.filterValue.value1!=null){me.elContainerPopupDateFilter.elValue1.setDate(oHead.filterValue.value1);}
if(oHead.filterValue.value2!=null){me.elContainerPopupDateFilter.elValue2.setDate(oHead.filterValue.value2);}}
this.oPopupDateFilter.display();this.elContainerPopupDateFilter.elLegend.innerHTML=oHead.caption;setValue();this.elContainerPopupDateFilter.elBtnOk.onclick=function(e){oHead.filterValue=getValue();me.oPopupDateFilter.hide();me.executeEventNormal(e,EventName.filter);};};GridViewBTD.prototype.createDateFilter=function(elCell,oHead){var me=this;var elTable=document.createElement('TABLE');elTable.className="numberFilterBTD";elTable.border=0;elCell.appendChild(elTable);var r=elTable.insertRow(0);var c=r.insertCell(0);var elRow=elCell.parentNode;var t=(new Date()).getTime();elCell.element=new CalendarBTD(c,"elCalendar"+this.myName+oHead.name+t+''+elRow.rowIndex,"",false);elCell.element.setWidth("100%");if(oHead.filterValue!=null){elCell.element.setDate(oHead.filterValue);}
elCell.element.addEvent(EventNameCalendar.change,function(e){me.executeEventNormal(e,EventName.filter);});c=r.insertCell(1);var btnFilter=document.createElement('DIV');btnFilter.className='btnFilterBTD';c.appendChild(btnFilter);utilObj.addEvent(btnFilter,EventName.click,function(e){me.showPopupDateFilter(elCell,oHead);});};GridViewBTD.prototype.createElFilterCellOfTHead=function(elRow,oHead){var elCell=elRow.insertCell(elRow.cells.length);elCell.myName=this.myName;elCell.oHead=oHead;oHead.isAllowFilter=oHead.isAllowFilter!=null?oHead.isAllowFilter:false;if(!oHead.isAllowFilter)return elCell;switch(oHead.type){case ColummType.labelNumber:case ColummType.number:this.createNumberFilter(elCell,oHead);break;case ColummType.email:case ColummType.textBox:case ColummType.label:case ColummType.richText:case ColummType.textArea:case ColummType.hyperLink:this.createTextBoxFilter(elCell,oHead);break;case ColummType.labelDate:case ColummType.date:case ColummType.labelDateTime:this.createDateFilter(elCell,oHead);break;case ColummType.checkBox:case ColummType.labelCheckBox:case ColummType.tripleBox:this.createTripleBoxFilter(elCell,oHead);break;case ColummType.radioBox:oHead.dataMSB={useQuote:false,isShowButtonOK:true,mapField:{value:"value",text:"text",search:"text",display:[{field:"text"}]},data:oHead.listItem};this.createMultiSelectBoxFilter(elCell,oHead);break;case ColummType.color:if(oHead.dataMSB==null)break;oHead.dataMSB.isShowButtonOK=true;this.createMultiSelectBoxFilter(elCell,oHead);break;case ColummType.labelMultiSelectBox:case ColummType.multiSelectBox:oHead.dataMSB.isShowButtonOK=true;this.createMultiSelectBoxFilter(elCell,oHead);break;case ColummType.labelSelectBox:case ColummType.labelEditSelectBox:case ColummType.selectBox:oHead.dataMSB=oHead.dataDDL;oHead.dataMSB.isShowButtonOK=true;this.createMultiSelectBoxFilter(elCell,oHead);break;default:break;}
return elCell;};GridViewBTD.prototype.checkParentHaxFixed=function(){return utilObj.checkParentHaxFixed(this.elContainerGV);};GridViewBTD.prototype.getElContainer=function(){var re=null;if(typeof(this.objContainer)=="string")
re=utilObj.getElById(this.objContainer);else
re=this.objContainer;return re;};GridViewBTD.prototype.createTable=function(className){var el=utilObj.createEl("TABLE");el.cellSpacing=el.cellPadding=0;el.className=className;el.style.overflow="hidden";el.style.tableLayout="fixed";el.style.textOverflow="ellipsis";var elRow=el.insertRow(0);this.setElNoHeight(elRow);return el;}
GridViewBTD.prototype.setCBodyNotOverflow=function(){this.elContainerGV.cBody.style.overflowY="inherit";this.elContainerGV.cBody.style.maxHeight="inherit";};GridViewBTD.prototype.disposeGridView=function(){};GridViewBTD.prototype.createGridView=function(){var me=this;var elC=this.getElContainer();if(elC==null){alert("Lỗi, không có object để chứa Grid.");this.hasError=true;return;}
this.elContainerGV=utilObj.createEl("DIV");this.elContainerGV.className="containerGV";elC.appendChild(this.elContainerGV);this.disposeGridView=function(){elC.removeChild(me.elContainerGV);me.disposeTHead();};this.elContainerGV.cHeader=utilObj.createEl("DIV");this.elContainerGV.cHeader.className="cHeaderGV";this.elContainerGV.appendChild(this.elContainerGV.cHeader);this.elContainerGV.cHeader.child=utilObj.createEl("DIV");this.elContainerGV.cHeader.child.style.overflow="hidden";this.elContainerGV.cHeader.appendChild(this.elContainerGV.cHeader.child);var el=this.createTable("gridViewH");this.elContainerGV.cHeader.table=el;this.elContainerGV.cHeader.child.appendChild(el);var elBS=utilObj.createEl("DIV");elBS.className="blockScroll";this.elContainerGV.cHeader.appendChild(elBS);this.elContainerGV.cBody=utilObj.createEl("DIV");this.elContainerGV.cBody.style.overflowY="scroll";$(this.elContainerGV.cBody).scroll(function(e){me.elContainerGV.cHeader.child.scrollLeft=me.elContainerGV.cFooter.child.scrollLeft=me.elContainerGV.cBody.scrollLeft;});this.setHeightGrid(this.configData.heightGrid);this.elContainerGV.appendChild(this.elContainerGV.cBody);if(this.isShowAllPage){this.elContainerGV.cBody.dicTable={};for(var i=1;i<=this.totalPage;i++){el=this.createTable("gridView");this.elContainerGV.cBody.dicTable["page-"+i]=el;var elContainer=utilObj.createEl("DIV");elContainer.appendChild(el);this.elContainerGV.cBody.appendChild(elContainer);}}
else{el=this.createTable("gridView");this.elContainerGV.cBody.table=el;this.elContainerGV.cBody.appendChild(el);}
this.elContainerGV.cFooter=utilObj.createEl("DIV");this.elContainerGV.cFooter.className="cFooterGV";this.elContainerGV.appendChild(this.elContainerGV.cFooter);this.elContainerGV.cFooter.child=utilObj.createEl("DIV");this.elContainerGV.cFooter.child.style.overflow="hidden";this.elContainerGV.cFooter.appendChild(this.elContainerGV.cFooter.child);el=this.createTable("gridViewF");this.elContainerGV.cFooter.table=el;this.elContainerGV.cFooter.child.appendChild(el);this.elContainerGV.cFooterPaging=utilObj.createEl("DIV");this.elContainerGV.appendChild(this.elContainerGV.cFooterPaging);};GridViewBTD.prototype.getPositionView=function(){return utilObj.getElementPositionView(this.elContainerGV);};GridViewBTD.prototype.getSize=function(){return utilObj.getElementSize(this.elContainerGV);};GridViewBTD.prototype.setHeightGrid=function(height){var detal=23;if(this.isShowFilterHeaderRow)detal+=25;if(this.isShowPaging)detal+=30;if(this.isShowTotal)detal+=22;this.configData.heightGrid=height;this.elContainerGV.cBody.style.maxHeight=(this.configData.heightGrid-detal)+'px';};GridViewBTD.prototype.getColumnIndex=function(name){return this.listMapHeader[name].elCell.cellIndex;};GridViewBTD.prototype.getHeadByName=function(name){for(var i=0;i<this.configData.head.length;i++){var item=this.configData.head[i];if(item.name==name)return item;}
return null;};GridViewBTD.prototype.convertDataMSBOrDDL=function(configData){configData.dataDic={};for(var i=0;i<configData.data.length;i++){var item=configData.data[i];configData.dataDic[item[configData.mapField.value]]=item;}};GridViewBTD.prototype.createElCellOfTHead=function(elRow,item){var elCell=elRow.insertCell(elRow.cells.length);elCell.myName=this.myName;elCell.className=this.cssHeaderTD;item.isAllowHide=item.isAllowHide!=null?item.isAllowHide:true;if(item.type==ColummType.labelMultiSelectBox){this.convertDataMSBOrDDL(item.dataMSB);}
else if(item.type==ColummType.labelSelectBox){this.convertDataMSBOrDDL(item.dataDDL);}
else if(item.type==ColummType.labelEditSelectBox){this.convertDataMSBOrDDL(item.dataDDL);item.elConEditSelectBox=document.createElement('DIV');item.elEditSelectBox=new DropDownListBTD(item.elConEditSelectBox,item.dataDDL,item.name+"_oDDLEdit","",false);item.elEditSelectBox.addEvent(EventNameDDL.change,function(){if(item.elEditSelectBox.funcChange!=null)item.elEditSelectBox.funcChange();});}
item.alt=item.alt!=null?item.alt.trim():"";if(item.alt!=""&&typeof(Tip)!="undefined"){Tip.register(elCell,item.alt);}
var elDiv=utilObj.createEl("DIV");if(this.isAllowHideColumn){this.showOrHideColumn(elDiv);if(item.isAllowHide){this.createItemMenuColumn(item);}}
elCell.element=elDiv;elCell.appendChild(elDiv);if(typeof(item.captionNote)!="undefined"){elDiv.title=item.captionNote;}
elDiv.className=this.cssHeaderText;if(item.cssHeader!=null&&item.cssHeader!=""){elDiv.className+=" "+item.cssHeader;}
var elLabel=utilObj.createEl("LABEL");elLabel.innerHTML=item.caption;elDiv.appendChild(elLabel);if(this.isAllowSortColumn){var elIconSort=utilObj.createEl("DIV");elIconSort.className="sort "+(item.sortType!=null&&item.sortType!=SortType.noSort?item.sortType:SortType.none);elDiv.appendChild(elIconSort);elCell.elIconSort=elIconSort;if(item.sortType==SortType.asc||item.sortType==SortType.desc){this.dicColumSort[item.name]={field:item.name,typeSort:item.sortType};}}
return elCell;};GridViewBTD.prototype.getHeaderRow=function(){return this.elHeaderRow;};GridViewBTD.prototype.setElNoHeight=function(el){el.style.height=el.style.fontSize=el.style.borderWidth=el.style.padding=el.style.margin='0px';};GridViewBTD.prototype.createCellDefineWidth=function(row,width,isShow){var c=row.insertCell(row.cells.length);this.setElNoHeight(c);c.style.width=width+'px';c.style.display=isShow?'':'none';};GridViewBTD.prototype.disposeTHead=function(){};GridViewBTD.prototype.createTHead=function(){var elTable=this.elContainerGV.cHeader.table;var elRowH=elTable.rows[0];var elRowF=this.elContainerGV.cFooter.table.rows[0];var elHeaderRow=elTable.insertRow(1);this.elHeaderRow=elHeaderRow;elHeaderRow.className="rowHeader";var elFilterHeaderRow=elTable.insertRow(2);this.elFilterHeaderRow=elFilterHeaderRow;elFilterHeaderRow.className="rowFilterHeader";elFilterHeaderRow.style.display=this.isShowFilterHeaderRow?'':'none';var elCell=null;var elFilterCell=null;var isLoadFormCookie=false;var isHasTotal=false;if(this.isAllowSortColumn||this.isAllowHideColumn||this.isAllowFilterColumn){this.createMainMenu();}
if(this.isAllowHideColumn){this.createBtnShowCol();this.createMenuColumn();var self=this;function onMouseUpHideCol(e){self.onShowOrHideColMouseUp(e);}
this.disposeTHead=function(){utilObj.removeEvent(document,"mouseup",onMouseUpHideCol);}
utilObj.addEvent(document,"mouseup",onMouseUpHideCol);}
if(this.isAllowStoreCookie){this.createCookieName();this.oCacheHeader=this.getCookie();}
isLoadFormCookie=this.oCacheHeader!=null;var totalW=0;var me=this;if(this.isAllowSelectRow){this.createCellDefineWidth(elRowH,this.widthOfSelectionColumn,true);if(this.isShowAllPage){for(var k=1;k<=this.totalPage;k++){var elRowB=this.elContainerGV.cBody.dicTable["page-"+k].rows[0];this.createCellDefineWidth(elRowB,this.widthOfSelectionColumn,true);}}
else{var elRowB=this.elContainerGV.cBody.table.rows[0];this.createCellDefineWidth(elRowB,this.widthOfSelectionColumn,true);}
this.createCellDefineWidth(elRowF,this.widthOfSelectionColumn,true);this.createElCellSelectAllRow(elHeaderRow);totalW+=this.widthOfSelectionColumn;elFilterCell=elFilterHeaderRow.insertCell(elFilterHeaderRow.cells.length);}
if(isLoadFormCookie){for(var name in this.oCacheHeader){var item=this.getHeadByName(name);if(item==null)continue;item.isShow=this.oCacheHeader[name].display=="";item.isAllowResize=item.isAllowResize!=null?item.isAllowResize:true;item.sortType=this.oCacheHeader[name].sortType;item.updateIsReadOnly=item.updateIsReadOnly!=null?item.updateIsReadOnly:false;item.width=this.oCacheHeader[name].width;this.createCellDefineWidth(elRowH,item.width,item.isShow);if(this.isShowAllPage){for(var k=1;k<=this.totalPage;k++){var elRowB=this.elContainerGV.cBody.dicTable["page-"+k].rows[0];this.createCellDefineWidth(elRowB,item.width,item.isShow);}}
else{elRowB=this.elContainerGV.cBody.table.rows[0];this.createCellDefineWidth(elRowB,item.width,item.isShow);}
this.createCellDefineWidth(elRowF,item.width,item.isShow);var elCellTHead=this.createElCellOfTHead(elHeaderRow,item);elCellTHead.style.display=item.isShow?'':'none';totalW+=item.isShow?item.width:0;var head={item:item,elCell:elCellTHead};elCellTHead.head=head;var indexList=this.isAllowSelectRow?this.oCacheHeader[name].position-1:this.oCacheHeader[name].position;this.listMapHeader[indexList]=this.listMapHeader[name]=head;if(item.type==ColummType.labelNumber||item.type==ColummType.number){item.total=0;isHasTotal=true;}
elFilterCell=this.createElFilterCellOfTHead(elFilterHeaderRow,item);elFilterCell.style.display=item.isShow?'':'none';}}
else{for(var i=0;i<this.configData.head.length;i++){var item=this.configData.head[i];item.isShow=item.isShow!=null?item.isShow:true;item.isAllowResize=item.isAllowResize!=null?item.isAllowResize:true;item.sortType=item.sortType!=null?item.sortType:SortType.none;item.updateIsReadOnly=item.updateIsReadOnly!=null?item.updateIsReadOnly:false;item.width=item.width!=null?item.width:100;totalW+=item.isShow?item.width:0;this.createCellDefineWidth(elRowH,item.width,item.isShow);if(this.isShowAllPage){for(var k=1;k<=this.totalPage;k++){var elRowB=this.elContainerGV.cBody.dicTable["page-"+k].rows[0];this.createCellDefineWidth(elRowB,item.width,item.isShow);}}
else{elRowB=this.elContainerGV.cBody.table.rows[0];this.createCellDefineWidth(elRowB,item.width,item.isShow);}
this.createCellDefineWidth(elRowF,item.width,item.isShow);var elCellTHead=this.createElCellOfTHead(elHeaderRow,item);elCellTHead.style.display=item.isShow?'':'none';var head={item:item,elCell:elCellTHead};elCellTHead.head=head;this.listMapHeader[i]=this.listMapHeader[item.name]=head;if(item.type==ColummType.labelNumber||item.type==ColummType.number){item.total=0;isHasTotal=true;}
elFilterCell=this.createElFilterCellOfTHead(elFilterHeaderRow,item);elFilterCell.style.display=item.isShow?'':'none';}}
if(this.isShowAddNew||this.isShowEdit||this.isShowDelete){this.createCellDefineWidth(elRowH,this.widthOfFunctionColumn,true);if(this.isShowAllPage){for(var i=1;i<=this.totalPage;i++){var elRowB=this.elContainerGV.cBody.dicTable["page-"+i].rows[0];this.createCellDefineWidth(elRowB,this.widthOfFunctionColumn,true);}}
else{elRowB=this.elContainerGV.cBody.table.rows[0];this.createCellDefineWidth(elRowB,this.widthOfFunctionColumn,true);}
this.createCellDefineWidth(elRowF,this.widthOfFunctionColumn,true);this.createFunctionAddNew(elHeaderRow);totalW+=this.widthOfFunctionColumn;elFilterCell=elFilterHeaderRow.insertCell(elFilterHeaderRow.cells.length);}
this.gvWidth=totalW;this.elContainerGV.cHeader.table.style.width=totalW+'px';if(this.isShowAllPage){for(var i=1;i<=this.totalPage;i++){this.elContainerGV.cBody.dicTable["page-"+i].style.width=totalW+'px';}}
else{this.elContainerGV.cBody.table.style.width=totalW+'px';}
this.elContainerGV.cFooter.table.style.width=totalW+'px';if(!isHasTotal)this.elContainerGV.cFooter.style.display='none';if(this.configData.widthGrid==null){this.configData.widthGrid=totalW+18;}
this.updateWidthContainer();};GridViewBTD.prototype.updateWidthContainer=function(){this.elContainerGV.cFooter.child.style.width=this.elContainerGV.cHeader.child.style.width=(this.configData.widthGrid-18)+'px';this.elContainerGV.cHeader.style.width=this.elContainerGV.cBody.style.width=this.elContainerGV.cFooter.style.width=this.elContainerGV.style.width=this.configData.widthGrid+'px';};GridViewBTD.prototype.convertFormulaSum=function(formula){for(var i=0;i<this.configData.head.length;i++){var oHead=this.configData.head[i];if(oHead.type!=ColummType.formula){formula=formula.replace(eval('\/\\['+oHead.field+'\\]\/gi'),oHead.total);}}
return formula;};GridViewBTD.prototype.calcTotal=function(){if(!this.isShowTotal)return;var elRow=this.elContainerGV.cFooter.table.rows[1];for(var i=0;i<this.configData.head.length;i++){var oHead=this.configData.head[i];var elCell=elRow.cells[this.listMapHeader[oHead.name].elCell.cellIndex];if(oHead.cssItem!=null&&oHead.cssItem!=""){elCell.className=oHead.cssItem;}
if((oHead.type==ColummType.number||oHead.type==ColummType.labelNumber||oHead.type==ColummType.formula)&&oHead.isShowTotal){elCell.style.textAlign='right';elCell.element=utilObj.createEl("LABEL");var v=oHead.total;if(v!=null){v=(v+"").replace(/\./gi,",");v=utilObj.formatNumber(v,".");elCell.element.innerHTML=v;}
elCell.innerHTML='';elCell.appendChild(elCell.element);if(oHead.unit!=null&&oHead.unit.text!=null){if(oHead.unit.isFrontOf){elCell.element.innerHTML=oHead.unit.text+" "+elCell.element.innerHTML;}
else{elCell.element.innerHTML+=" "+oHead.unit.text;}}}}};GridViewBTD.prototype.createTFoot=function(){if(!this.isShowTotal)return;var elTable=this.elContainerGV.cFooter.table;var elRow=elTable.insertRow(elTable.rows.length);var elCell=null;if(this.isAllowSelectRow){elCell=elRow.insertCell(0);elCell.style.borderBottom=elCell.style.borderLeft=this.borderCss;}
for(var i=0;i<this.listMapHeader.length;i++){var oHead=this.listMapHeader[i].item;var elCell=elRow.insertCell(elRow.cells.length);elCell.style.borderBottom=elCell.style.borderLeft=this.borderCss;elCell.style.display=oHead.isShow?'':'none';}
if(this.isShowAddNew||this.isShowEdit||this.isShowDelete){elCell=elRow.insertCell(elRow.cells.length);elCell.style.borderBottom=elCell.style.borderLeft=this.borderCss;}};GridViewBTD.prototype.createTBody=function(elTable){for(var i=0;i<elTable.data.length;i++){this.insertRow(elTable,elTable.data[i],true);}};GridViewBTD.prototype.insertRowDetail=function(elTable,isLast){var elRow=elTable.insertRow(isLast?elTable.rows.length:1);elRow.className=elRow.rowIndex%2==0?"alternatingBgColor":"bgColor";elRow.item=item;elRow.myName=this.myName;item.elRow=elRow;var colSpan=0;if(this.isAllowSelectRow){colSpan++;}
colSpan+=this.listMapHeader.length;if(this.isShowAddNew||this.isShowEdit||this.isShowDelete){colSpan++;}
var elCell=elRow.insertCell(0);elCell.colSpan=colSpan;var e=new Object();e.boundStatus=BoundStatus.insert;this.executeEventForRow(e,elRow,EventName.rowDataBoundDetail);return elRow;};GridViewBTD.prototype.getRowByIndex=function(index){if(this.isShowAllPage){var elTable=this.elContainerGV.cBody.dicTable["page-"+1];return null;}
else{return this.elContainerGV.cBody.table.rows[index+1];}};GridViewBTD.prototype.insertRow=function(elTable,item,isLast){var elRow=elTable.insertRow(isLast?elTable.rows.length:1);elRow.className=elRow.rowIndex%2==0?"alternatingBgColor":"bgColor";elRow.item=item;elRow.myName=this.myName;item.elRow=elRow;if(this.configData.fieldKey!=null&&item[this.configData.fieldKey]!=null){this.dicRow[item[this.configData.fieldKey]]=elRow;}
if(this.isAllowSelectRow){var elCell=this.createElCellSelectRow(elRow);elCell.style.borderBottom=elCell.style.borderLeft=this.borderCss;}
for(var i=0;i<this.listMapHeader.length;i++){var elCell=this.insertCell(elRow,this.listMapHeader[i].item);if(this.oCacheHeader!=null&&this.oCacheHeader[this.listMapHeader[i].item.name].display=="none"||!this.listMapHeader[i].item.isShow){elCell.style.display="none";}
elCell.style.borderBottom=elCell.style.borderLeft=this.borderCss;}
if(this.isShowAddNew||this.isShowEdit||this.isShowDelete){var elCell=this.createFunctionUpdate(elRow);elCell.style.borderBottom=elCell.style.borderLeft=this.borderCss;}
this.mapEventForRow(elRow);var e=new Object();e.boundStatus=BoundStatus.insert;this.executeEventForRow(e,elRow,EventName.rowDataBound);return elRow;};GridViewBTD.prototype.insertCell=function(elRow,oHead){var elCell=elRow.insertCell(elRow.cells.length);var item=elRow.item;if(oHead.cssItem!=null&&oHead.cssItem!=""){elCell.className=oHead.cssItem;}
switch(oHead.type){case ColummType.hyperLink:this.createHyperLink(elCell,oHead);break;case ColummType.linkButton:this.createLinkButton(elCell,oHead);break;case ColummType.textBox:this.createTextBox(elCell,oHead);break;case ColummType.password:this.createPassword(elCell,oHead);break;case ColummType.tripleBox:this.createTripleBox(elCell,oHead);break;case ColummType.labelCheckBox:this.createLabelCheckBox(elCell,oHead);break;case ColummType.color:this.createColor(elCell,oHead);break;case ColummType.checkBox:this.createCheckBox(elCell,oHead);break;case ColummType.radioBox:this.createRadioBox(elCell,oHead);break;case ColummType.labelMultiSelectBox:this.createLabelMultiSelectBox(elCell,oHead);break;case ColummType.multiSelectBox:this.createMultiSelectBox(elCell,oHead);break;case ColummType.labelSelectBox:this.createLabelSelectBox(elCell,oHead);break;case ColummType.labelEditSelectBox:this.createLabelEditSelectBox(elCell,oHead);break;case ColummType.selectBox:this.createSelectBox(elCell,oHead);break;case ColummType.email:case ColummType.label:this.createLabel(elCell,oHead);break;case ColummType.formula:this.createFormula(elCell,oHead);oHead.total+=elCell.element.valueTotalFormula;break;case ColummType.number:this.createNumber(elCell,oHead);oHead.total+=parseFloat(item[oHead.field]);break;case ColummType.labelNumber:this.createLabelNumber(elCell,oHead);oHead.total+=parseFloat(item[oHead.field]);break;case ColummType.labelDate:this.createLabelDate(elCell,oHead);break;case ColummType.labelDateTime:this.createLabelDateTime(elCell,oHead);break;case ColummType.file:this.createLinkFile(elCell,oHead);break;case ColummType.image:this.createImage(elCell,oHead);break;case ColummType.richText:this.createRichText(elCell,oHead);break;case ColummType.textArea:this.createTextArea(elCell,oHead);break;case ColummType.date:this.createDate(elCell,oHead);break;case ColummType.labelTime:this.createLabelTime(elCell,oHead);break;}
return elCell;};GridViewBTD.prototype.updateCell=function(oHead,cellIndex){var elCell=this.elRowEdit.cells[cellIndex];switch(oHead.type){case ColummType.file:elCell.element.href=oHead.path+this.elRowEdit.item[oHead.field];elCell.element.innerHTML=(this.elRowEdit.item[oHead.field]==null)?"":this.elRowEdit.item[oHead.field];break;case ColummType.hyperLink:elCell.element.href=this.elRowEdit.item[oHead.fieldURL];elCell.element.innerHTML=(this.elRowEdit.item[oHead.field]==null)?"":this.elRowEdit.item[oHead.field];break;case ColummType.color:elCell.element.style.backgroundColor="#"+this.elRowEdit.item[oHead.field];break;case ColummType.linkButton:elCell.element.innerHTML=(this.elRowEdit.item[oHead.field]==null)?"":this.elRowEdit.item[oHead.field];break;case ColummType.textBox:elCell.element.value=(this.elRowEdit.item[oHead.field]==null)?"":this.elRowEdit.item[oHead.field];break;case ColummType.tripleBox:var value=(this.elRowEdit.item[oHead.field]==null)?"":this.elRowEdit.item[oHead.field];if(value!=""){elCell.element.setValue(value);}
break;case ColummType.labelCheckBox:if(this.elRowEdit.item[oHead.field]!=null&&typeof this.elRowEdit.item[oHead.field]=="boolean"){elCell.element.innerHTML=this.elRowEdit.item[oHead.field]?oHead.valueTrue:oHead.valueFalse;}
break;case ColummType.checkBox:elCell.element.checked=this.elRowEdit.item[oHead.field];break;case ColummType.radioBox:var listElement=elCell.listElement;for(var i=0;i<listElement.length;i++){listElement[i].checked=this.elRowEdit.item[oHead.field]==listElement[i].value;}
break;case ColummType.labelMultiSelectBox:var re="";var listData=this.elRowEdit.item[oHead.field];if(listData!=null){if(typeof(listData)=='string'){listData=listData.split(oHead.dataMSB.textSeparator);}
for(var i=0;i<listData.length;i++){if(listData[i]==null||oHead.dataMSB.dataDic[listData[i]]==null)continue;var data=oHead.dataMSB.dataDic[listData[i]][oHead.dataMSB.mapField.text];if(data!=null){if(re!="")re+="; ";re+=data;}}}
elCell.element.innerHTML=re;break;case ColummType.multiSelectBox:var dicData=utilObj.convertArrayToDictionary(this.elRowEdit.item[oHead.field]);elCell.element.selectedValues(dicData);break;case ColummType.labelSelectBox:case ColummType.labelEditSelectBox:var data=this.elRowEdit.item[oHead.field];var re='';if(data!=null){if(oHead.dataDDL.dataDic[data]!=null){re=oHead.dataDDL.dataDic[data][oHead.dataDDL.mapField.text];}}
elCell.element.innerHTML=re;break;case ColummType.selectBox:elCell.element.selectedValue((this.elRowEdit.item[oHead.field]==null)?"":this.elRowEdit.item[oHead.field]);break;case ColummType.email:case ColummType.label:elCell.element.innerHTML=(this.elRowEdit.item[oHead.field]==null)?"":this.elRowEdit.item[oHead.field];break;case ColummType.labelNumber:var v=this.elRowEdit.item[oHead.field];if(v!=null){v=(v+"").replace(/\./gi,",");v=utilObj.formatNumber(v,".");elCell.element.innerHTML=v;if(oHead.unit!=null&&oHead.unit.text!=null){if(oHead.unit.isFrontOf){elCell.element.innerHTML=oHead.unit.text+" "+elCell.element.innerHTML;}
else{elCell.element.innerHTML+=" "+oHead.unit.text;}}}
break;case ColummType.number:var v=this.elRowEdit.item[oHead.field];if(v!=null){v=(v+"").replace(/\./gi,",");v=utilObj.formatNumber(v,".");elCell.element.value=v;}
break;case ColummType.labelTime:var value="";if(this.elRowEdit.item[oHead.field]!=""&&this.elRowEdit.item[oHead.field]!=null){if(!(this.elRowEdit.item[oHead.field]instanceof Date)){this.elRowEdit.item[oHead.field]=Date.parseDate(this.elRowEdit.item[oHead.field],Date.stringFormat.dateTime);}
value=this.elRowEdit.item[oHead.field].toVNString(Date.stringFormat.time);}
elCell.element.innerHTML=value;break;case ColummType.labelDate:var value="";if(this.elRowEdit.item[oHead.field]!=""&&this.elRowEdit.item[oHead.field]!=null){if(!(this.elRowEdit.item[oHead.field]instanceof Date)){this.elRowEdit.item[oHead.field]=Date.parseDate(this.elRowEdit.item[oHead.field],Date.stringFormat.dateTime);}
value=this.elRowEdit.item[oHead.field].toVNString(Date.stringFormat.date);}
elCell.element.innerHTML=value;break;case ColummType.labelDateTime:var value="";if(this.elRowEdit.item[oHead.field]!=""&&this.elRowEdit.item[oHead.field]!=null){if(!(this.elRowEdit.item[oHead.field]instanceof Date)){this.elRowEdit.item[oHead.field]=Date.parseDate(this.elRowEdit.item[oHead.field],Date.stringFormat.dateTime);}
value=this.elRowEdit.item[oHead.field].toVNString();}
elCell.element.innerHTML=value;break;case ColummType.image:if(this.elRowEdit.item[oHead.field]==null||this.elRowEdit.item[oHead.field]==''){elCell.element.src=oHead.pathNoImage;}
else{elCell.element.src=oHead.path+this.elRowEdit.item[oHead.field];}
break;case ColummType.textArea:elCell.element.value=(this.elRowEdit.item[oHead.field]==null)?"":this.elRowEdit.item[oHead.field];break;case ColummType.richText:elCell.element.setContent(this.elRowEdit.item[oHead.field]==null?"":this.elRowEdit.item[oHead.field]);break;case ColummType.date:var value="";if(this.elRowEdit.item[oHead.field]!=""&&this.elRowEdit.item[oHead.field]!=null){if(!(this.elRowEdit.item[oHead.field]instanceof Date)){this.elRowEdit.item[oHead.field]=Date.parseDate(this.elRowEdit.item[oHead.field],Date.stringFormat.dateTime);}
value=this.elRowEdit.item[oHead.field];}
elCell.element.setDate(value);break;}};GridViewBTD.prototype.getRowByKey=function(valueKey){return this.dicRow[valueKey];};GridViewBTD.prototype.dataBind=function(){if(this.isShowAllPage){this.isShowAddNew=false;this.isShowEdit=false;this.isShowDelete=false;}
this.widthOfFunctionColumn=this.isHideColumnFunction?0:this.isShowTextFunction?120:60;var self=this;this.createGridView();if(this.hasError){return;}
this.createTHead();if(this.isShowAllPage){var elTable=this.elContainerGV.cBody.dicTable["page-"+1];elTable.data=this.configData.data;this.createTBody(elTable);if(elTable.data==null||elTable.data.length==0){elTable.rows[0].style.height='1px';}
else{elTable.rows[0].style.height='0px';}
setTimeout(function(){self.calcHeightForAllPage();self.scrollLoadData();},500);$(this.elContainerGV.cBody).scroll(function(e){self.scrollLoadData();});}
else{var elTable=this.elContainerGV.cBody.table;elTable.data=this.configData.data;this.createTBody(elTable);if(elTable.data==null||elTable.data.length==0){elTable.rows[0].style.height='1px';}
else{elTable.rows[0].style.height='0px';}}
this.createTFoot();this.calcTotal();if(this.isAllowMoveColumn){this.moveColumn();}
if(this.isAllowResizeColumn){this.createElResizeDisplay();}
utilObj.addEvent(document,"mousedown",function(e){if(self.isAllowResizeColumn){self.onResizeColMouseDown(e);}
if(self.isAllowMoveColumn){self.onMoveColMouseDown(e);}
if(self.isAllowSelectRow){self.onMultiSelectRowMouseDown(e);}});utilObj.addEvent(document,"mousemove",function(e){if(self.isAllowResizeColumn){self.onResizeColMouseMove(e);}
if(self.isAllowMoveColumn){self.onMoveColMouseMove(e);}});utilObj.addEvent(document,"mouseup",function(e){if(self.isAllowSortColumnByClickHeader){self.onSortColMouseUp(e);}
if(self.isAllowResizeColumn){self.onResizeColMouseUp(e);}
if(self.isAllowMoveColumn){self.onMoveColMouseUp(e);}});};GridViewBTD.prototype.functionLoadDataFromServer=function(condition,begin,end,func){};GridViewBTD.prototype.scrollLoadData=function(){if(this.elContainerGV==null)return;var currentPage=parseInt((this.elContainerGV.cBody.scrollTop+parseInt(this.elContainerGV.cBody.style.maxHeight,10))/this.heightOfTable,10)+1;this.loadDataByIndexPage(currentPage-2);this.loadDataByIndexPage(currentPage-1);this.loadDataByIndexPage(currentPage);this.loadDataByIndexPage(currentPage+1);this.loadDataByIndexPage(currentPage+2);};GridViewBTD.prototype.getData=function(response){if(response.error!=null){alert(response.error.message);return null;}
var result=response.result;if(result==null){alert("Không có mạng.");return null;}
if(result.hasErrors){alert(result.errorsAlert);return null;}
return result.data;};GridViewBTD.prototype.loadDataByIndexPage=function(currentPage){if(!this.isShowAllPage)return;var elTable=this.elContainerGV.cBody.dicTable["page-"+currentPage];if(elTable==null||elTable.data!=null)return;this.currentPage=currentPage;var end=this.currentPage*this.viewRecord;var begin=end-this.viewRecord+1;this.pagingRecord={begin:begin,end:end};var me=this;elTable.parentNode.className="cTableGV";elTable.data=[];this.functionLoadDataFromServer(this.condition,begin,end,function(response){var data=me.getData(response);if(data==null)return;elTable.parentNode.className="";elTable.data=data.list;me.createTBody(elTable);});};GridViewBTD.prototype.setInitDataShowAllPage=function(viewRecord,totalRecord){if(!this.isShowAllPage){alert("Chưa cho thuộc tính isShowAllPage = true;");return;}
this.viewRecord=viewRecord;this.totalRecord=totalRecord;this.totalPage=parseInt(totalRecord/viewRecord,10);this.totalPage+=(totalRecord%this.viewRecord==0)?0:1;};GridViewBTD.prototype.calcHeightForAllPage=function(){if(!this.isShowAllPage)return;var remainingRow=this.totalRecord%this.viewRecord;var heightOfRow=parseInt(this.heightOfTable/this.viewRecord,10);for(var i=1;i<=this.totalPage;i++){var elTable=this.elContainerGV.cBody.dicTable["page-"+i];var elContainer=elTable.parentNode;if(i==1&&elTable.rows.length>1){heightOfRow=utilObj.getElementSize(elTable.rows[1]).height;this.heightOfTable=this.viewRecord*heightOfRow;}
if(i!=this.totalPage){elContainer.style.height=this.heightOfTable+'px';}
else{if(remainingRow>0){elContainer.style.height=(heightOfRow*remainingRow)+'px';}
else{elContainer.style.height=this.heightOfTable+'px';}}}};GridViewBTD.prototype.reloadDataShowAllPage=function(data){if(!this.isShowAllPage){alert("Chưa cho thuộc tính isShowAllPage = true;");return;}
else{this.isShowAddNew=false;this.isShowEdit=false;this.isShowDelete=false;}
for(var key in this.elContainerGV.cBody.dicTable){var elTable=this.elContainerGV.cBody.dicTable[key];this.elContainerGV.cBody.removeChild(elTable.parentNode);}
this.setInitDataShowAllPage(data.viewRecord,data.totalRecord);if(this.elSelectionAll!=null){this.elSelectionAll.checked=false;}
this.dicRow={};this.currentPage=1;this.elContainerGV.cBody.scrollTop=0;this.elContainerGV.cBody.dicTable={};for(var i=1;i<=this.totalPage;i++){el=this.createTable("gridView");el.rows[0].style.height='0px';this.elContainerGV.cBody.dicTable["page-"+i]=el;var elContainer=utilObj.createEl("DIV");elContainer.appendChild(el);this.elContainerGV.cBody.appendChild(elContainer);var elRowFirst=el.rows[0];if(this.isAllowSelectRow){this.createCellDefineWidth(elRowFirst,this.widthOfSelectionColumn,true);}
for(var k=0;k<this.listMapHeader.length;k++){var item=this.listMapHeader[k].item;this.createCellDefineWidth(elRowFirst,item.width,item.isShow);}
if(this.isShowAddNew||this.isShowEdit||this.isShowDelete){this.createCellDefineWidth(elRowFirst,this.widthOfFunctionColumn,true);}
el.style.width=this.gvWidth+'px';if(i==1){el.data=data.list;this.createTBody(el);}}
this.displayTotalRecord();var me=this;setTimeout(function(){me.calcHeightForAllPage();me.scrollLoadData();},500);};GridViewBTD.prototype.displayTotalRecord=function(){var me=this;function createTotalRecord(){var elContainerTable=utilObj.createEl("TABLE");elContainerTable.className="containerTablePaging";elContainerTable.style.width=me.gvWidth+'px';elContainerTable.cellPadding=elContainerTable.cellSpacing=elContainerTable.border="0";var elRow=elContainerTable.insertRow(0);var elCell=elRow.insertCell(0);elCell.style.width="20%";elCell.style.textAlign="left";elCell.innerHTML="Tổng: <b>"+utilObj.formatNumber(me.totalRecord,".")+"</b>";elCell=elRow.insertCell(1);elCell.style.width="80%";elCell.style.textAlign="right";return elContainerTable;};this.elContainerGV.cFooterPaging.innerHTML="";this.elContainerGV.cFooterPaging.table=createTotalRecord();this.elContainerGV.cFooterPaging.appendChild(this.elContainerGV.cFooterPaging.table);};GridViewBTD.prototype.reloadData=function(data){for(var i=0;i<this.configData.head.length;i++){var oHead=this.configData.head[i];oHead.total=0;}
if(this.isShowAllPage){this.reloadDataShowAllPage(data);}
else{this.elRowStartSelection=null;this.reloadDataNoShowAllPage();}};GridViewBTD.prototype.reloadDataNoShowAllPage=function(){if(this.isShowAllPage)return;if(this.elSelectionAll!=null){this.elSelectionAll.checked=false;}
this.dicRow={};var elTableB=this.elContainerGV.cBody.table;while(elTableB.rows.length>1){elTableB.deleteRow(1);}
elTableB.data=this.configData.data;if(elTableB.data==null||elTableB.data.length>0){elTableB.rows[0].style.height='0px';}
else{elTableB.rows[0].style.height='1px';}
this.createTBody(elTableB);this.calcTotal();};GridViewBTD.prototype.insertNewRow=function(item,isLast){this.configData.data.push(item);this.setTotalRecord(true);var elTableB=this.elContainerGV.cBody.table;isLast=isLast==null?false:isLast;var elNewRow=this.insertRow(elTableB,item,isLast);var start=elNewRow.rowIndex+1;for(var i=start;i<elTableB.rows.length;i++){if(this.isAllowSelectRow&&elTableB.rows[i].cells[0].element.checked)continue;elTableB.rows[i].className=i%2==0?"alternatingBgColor":"bgColor";}
return elNewRow;};GridViewBTD.prototype.updateRow=function(item){this.elRowEdit.item=item;item.elRow=this.elRowEdit;for(var i=0;i<this.listMapHeader.length;i++){var index=this.isAllowSelectRow?1+i:i;this.updateCell(this.listMapHeader[i].item,index);}
var e=new Object();e.boundStatus=BoundStatus.update;this.executeEventForRow(e,this.elRowEdit,EventName.rowDataBound);};GridViewBTD.prototype.removeRow=function(elRow){for(var i=0;i<this.configData.data.length;i++){if(elRow.rowIndex==this.configData.data[i].elRow.rowIndex){this.configData.data.splice(i,1);break;}}
var elTableB=this.elContainerGV.cBody.table;var start=elRow.rowIndex+1;for(var i=start;i<elTableB.rows.length;i++){if(this.isAllowSelectRow&&elTableB.rows[i].cells[0].element.checked)continue;elTableB.rows[i].className=i%2!=0?"alternatingBgColor":"bgColor";}
elTableB.deleteRow(elRow.rowIndex);this.setTotalRecord(false);var e=new Object();e.boundStatus=BoundStatus.remove;this.executeEventForRow(e,elRow,EventName.rowDataBound);};GridViewBTD.prototype.createFieldUpdateTextBox=function(elCell,w){elCell.element=utilObj.createEl("INPUT");elCell.element.type="text";elCell.element.className="inputText";elCell.element.style.width=w+"px";elCell.appendChild(elCell.element);};GridViewBTD.prototype.createFieldUpdatePassword=function(elCell,w){elCell.element=utilObj.createEl("INPUT");elCell.element.type="password";elCell.element.className="inputText";elCell.element.style.width=w+"px";elCell.appendChild(elCell.element);};GridViewBTD.prototype.createFieldUpdateNumberBox=function(elCell,w,oHead){elCell.element=utilObj.createEl("INPUT");elCell.element.type="text";elCell.element.className="inputText";elCell.element.style.width=w+"px";elCell.appendChild(elCell.element);utilObj.numeric(elCell.element);};GridViewBTD.prototype.createFieldUpdateTime=function(elCell,w){elCell.element=utilObj.createEl("INPUT");elCell.element.type="text";elCell.element.className="inputText";elCell.element.style.width=w+"px";elCell.appendChild(elCell.element);if(typeof jQuery!='undefined'){var el=$(elCell.element);if(el.setMask!=null){el.setMask({mask:'29:59:59'});}}};GridViewBTD.prototype.createFieldUpdateTripleBox=function(elCell){elCell.element=new TripleBoxBTD(elCell);elCell.element.init();};GridViewBTD.prototype.createFieldUpdateCheckBox=function(elCell){elCell.element=utilObj.createEl("INPUT");elCell.element.type="checkbox";elCell.appendChild(elCell.element);};GridViewBTD.prototype.createFieldUpdateRadioBox=function(elCell,oHead){var elRow=elCell.parentNode;elCell.listElement=[];for(var i=0;i<oHead.listItem.length;i++){var elRadio=utilObj.createEl("INPUT");elRadio.id=this.myName+"Update"+oHead.name+elRow.rowIndex+i;elRadio.name=this.myName+"Update"+oHead.name+elRow.rowIndex;elRadio.type="radio";elRadio.value=oHead.listItem[i].value;elCell.appendChild(elRadio);elCell.listElement.push(elRadio);var elLabel=utilObj.createEl("LABEL");elLabel.htmlFor=elRadio.id;elLabel.innerHTML=oHead.listItem[i].text;elCell.appendChild(elLabel);}};GridViewBTD.prototype.createFieldUpdateSelectBox=function(elCell,oHead,w){var elRow=elCell.parentNode;elCell.element=new DropDownListBTD(elCell,oHead.dataDDL,this.myName+"_oDDLUpdate"+elRow.rowIndex,"",false);elCell.element.setWidth(w);elCell.element.addEvent(EventNameDDL.change,function(e){if(oHead.onChange!=null){if(e==null)e={};e.element=elCell.element;oHead.onChange(e);}});};GridViewBTD.prototype.createFieldUpdateMultiSelectBox=function(elCell,oHead,w){var elRow=elCell.parentNode;elCell.element=new MultiSelectBoxBTD(elCell,oHead.dataMSB,this.myName+"_oMSBUpdate"+elRow.rowIndex);elCell.element.setWidth(w);};GridViewBTD.prototype.createFieldUpdateFile=function(elCell,rowIndex){elCell.elContainerFile=utilObj.createEl("DIV");elCell.appendChild(elCell.elContainerFile);elCell.element=utilObj.createEl("INPUT");elCell.element.name="imageFieldUpdateDataGV"+this.myName+rowIndex;elCell.element.className="inputText";elCell.element.type="file";elCell.appendChild(elCell.element);};GridViewBTD.prototype.createFieldUpdateTextArea=function(elCell,w){elCell.element=utilObj.createEl("TEXTAREA");elCell.element.rows=4;elCell.element.className="inputText";elCell.element.style.width=w+"px";elCell.appendChild(elCell.element);};GridViewBTD.prototype.createFieldUpdateColor=function(elCell){if(typeof jQuery!='undefined'){elCell.element=utilObj.createEl("DIV");elCell.element.style.border="1px solid #080808";elCell.element.style.width=elCell.element.style.height="18px";$(elCell.element).css('backgroundColor','#000000');$(elCell.element).ColorPicker({color:'#000000',onShow:function(colpkr){$(colpkr).fadeIn(500);return false;},onHide:function(colpkr){$(colpkr).fadeOut(500);return false;},onChange:function(hsb,hex,rgb){$(elCell.element).css('backgroundColor','#'+hex);}});}
else{elCell.element=utilObj.createEl("INPUT");elCell.element.type="text";elCell.element.className="inputText";elCell.element.style.width="60px";}
elCell.appendChild(elCell.element);};GridViewBTD.prototype.createFieldUpdateRichText=function(elCell){var elRow=elCell.parentNode;elCell.element=new ObjectIframe(elCell,this.myName+"elementRTE"+elRow.rowIndex,"",400,200,"inputText");};GridViewBTD.prototype.createFieldUpdateDate=function(elCell,w){var elRow=elCell.parentNode;elCell.element=new CalendarBTD(elCell,this.myName+"elCalendar"+elRow.rowIndex,"",false);elCell.element.setWidth(w);};GridViewBTD.prototype.createFieldUpdateKey=function(elCell){elCell.element=utilObj.createEl("INPUT");elCell.element.type="hidden";elCell.appendChild(elCell.element);};GridViewBTD.prototype.createFieldFormUpdate=function(oHead){var elRow=this.elTableFormUpdate.insertRow(this.elTableFormUpdate.rows.length);var elCell=elRow.insertCell(0);elCell.style.whiteSpace='nowrap';elCell.innerHTML=oHead.caption+(!oHead.isAllowUpdateNull?"<b style='color:red'>*</b>":"")+":";elCell=elRow.insertCell(1);oHead.elCellFormUpdate=elCell;var w=oHead.widthEdit!=null?oHead.widthEdit:(oHead.width!=null?oHead.width:200);w=w>500?500:(w<50?50:w);switch(oHead.typeUpdate){case ColummType.email:case ColummType.textBox:this.createFieldUpdateTextBox(elCell,w);break;case ColummType.time:this.createFieldUpdateTime(elCell,w);break;case ColummType.password:this.createFieldUpdatePassword(elCell,w);break;case ColummType.color:this.createFieldUpdateColor(elCell,w);break;case ColummType.number:this.createFieldUpdateNumberBox(elCell,w,oHead);break;case ColummType.tripleBox:this.createFieldUpdateTripleBox(elCell,w);break;case ColummType.checkBox:this.createFieldUpdateCheckBox(elCell);break;case ColummType.radioBox:this.createFieldUpdateRadioBox(elCell,oHead);break;case ColummType.multiSelectBox:this.createFieldUpdateMultiSelectBox(elCell,oHead,w);break;case ColummType.selectBox:this.createFieldUpdateSelectBox(elCell,oHead,w);break;case ColummType.file:case ColummType.image:this.hasFile=true;this.createFieldUpdateFile(elCell,elRow.rowIndex);break;case ColummType.textArea:this.createFieldUpdateTextArea(elCell,w);break;case ColummType.richText:this.createFieldUpdateRichText(elCell);break;case ColummType.date:this.createFieldUpdateDate(elCell,w);break;case ColummType.keyUpdate:this.createFieldUpdateKey(elCell);elRow.style.display="none";break;}
if(elCell.element!=null&&oHead.alt!=null&&oHead.alt!=""&&typeof(TipHelpBTD)!="undefined"){TipHelpBTD.register(elCell.element,oHead.alt);}
if(oHead.unit!=null){var elUnit=document.createElement('span');elUnit.innerHTML=" "+oHead.unit.text;elCell.appendChild(elUnit);}
var me=this;if(oHead.funcAutoValue!=null){oHead.callAuto=function(){if(me.isAddNewRecord){oHead.funcAutoValue(function(response){var data=me.getData(response);if(data==null)return;me.setValueForElement(oHead,data);});}};var cBtnRefresh=document.createElement('DIV');cBtnRefresh.className="cBtnRefresh";elCell.appendChild(cBtnRefresh);var btn=document.createElement('SPAN');btn.className="btnRefresh";cBtnRefresh.appendChild(btn);utilObj.addEvent(cBtnRefresh,'click',function(e){oHead.callAuto();});}};GridViewBTD.prototype.checkFieldFormUpdate=function(oHead){var elCell=oHead.elCellFormUpdate;oHead.isAllowUpdateNull=oHead.isAllowUpdateNull!=null?oHead.isAllowUpdateNull:false;if(oHead.typeUpdate==ColummType.time){var elV=elCell.element.value;var v=elV.split(':');function getVT(vTime){vTime=vTime==null||vTime.length==0?"00":(vTime.length==1?vTime+"0":vTime);return vTime;}
elV=getVT(v[0])+':'+getVT(v[1])+':'+getVT(v[2]);v=elV.split(':');if(parseInt(v[0],10)>23||parseInt(v[1],10)>59||parseInt(v[2],10)>59){alert("Mời bạn nhập \""+oHead.caption+"\" phải đúng cú pháp giờ < 24 và phút < 60 và giây < 60!");elCell.element.focus();return false;}
elCell.element.value=elV;}
if(oHead.isAllowUpdateNull){switch(oHead.typeUpdate){case ColummType.email:elCell.element.value=elCell.element.value.trim();if(elCell.element.value!=""&&!utilObj.isEmail(elCell.element.value)){alert("Mời bạn nhập \""+oHead.caption+"\" phải đúng cú pháp email!");elCell.element.focus();return false;}
break;case ColummType.number:var v=elCell.element.value.replace(/\./gi,"");if(v==""||!utilObj.isNumber(v)){alert("Mời bạn nhập \""+oHead.caption+"\" phải là số!");elCell.element.focus();return false;}
break;}
return true;}
if(!this.isAddNewRecord&&(oHead.typeUpdate==ColummType.file||oHead.typeUpdate==ColummType.image))return true;switch(oHead.typeUpdate){case ColummType.email:elCell.element.value=elCell.element.value.trim();if(elCell.element.value==""||!utilObj.isEmail(elCell.element.value)){alert("Mời bạn nhập \""+oHead.caption+"\" phải đúng cú pháp email!");elCell.element.focus();return false;}
break;case ColummType.number:var v=elCell.element.value.replace(/\./gi,"");if(v==""||!utilObj.isNumber(v)){alert("Mời bạn nhập \""+oHead.caption+"\" phải là số!");elCell.element.focus();return false;}
break;case ColummType.textBox:case ColummType.textArea:if(elCell.element.value.trim()==""){alert("Mời bạn nhập \""+oHead.caption+"\"!");elCell.element.focus();return false;}
break;case ColummType.file:case ColummType.image:if(elCell.element.value==""){alert("Mời bạn nhập \""+oHead.caption+"\"!");return false;}
if(elCell.element.files.length>0&&elCell.element.files[0].size>1024*1024*10){alert(oHead.caption+" phải < 10M!");return false;}
break;case ColummType.richText:if(elCell.element.getContent()==""){alert("Mời bạn nhập \""+oHead.caption+"\"!");elCell.element.focus();return false;}
break;case ColummType.date:if(elCell.element.getStringDate()==""){alert("Mời bạn chọn \""+oHead.caption+"\"!");elCell.element.focus();return false;}
break;case ColummType.radioBox:var isOk=false;for(var i=0;i<elCell.listElement.length;i++){if(elCell.listElement[i].checked){isOk=true;break;}}
if(!isOk){alert("Mời bạn chọn \""+oHead.caption+"\"!");return false;}
break;case ColummType.selectBox:case ColummType.multiSelectBox:var v=elCell.element.getValue();if(v==false)return true;if(v==null||v==""){alert("Mời bạn chọn \""+oHead.caption+"\"!");return false;}
break;}
return true;};GridViewBTD.prototype.focusElement=function(oHead){var elCell=oHead.elCellFormUpdate;switch(oHead.typeUpdate){case ColummType.color:if(data!=null){if(typeof jQuery!='undefined'){$(elCell.element).focus();}
else{elCell.element.focus();}}
break;case ColummType.image:case ColummType.file:break;case ColummType.number:elCell.element.focus();break;case ColummType.time:elCell.element.focus();break;case ColummType.email:case ColummType.textBox:case ColummType.textArea:case ColummType.keyUpdate:elCell.element.focus();break;case ColummType.radioBox:break;case ColummType.multiSelectBox:elCell.element.showList();break;case ColummType.selectBox:elCell.element.showList();break;case ColummType.tripleBox:break;case ColummType.checkBox:break;case ColummType.richText:elCell.element.focus();break;case ColummType.date:elCell.element.showList();break;}};GridViewBTD.prototype.setValueForElement=function(oHead,data){var elCell=oHead.elCellFormUpdate;switch(oHead.typeUpdate){case ColummType.color:if(data!=null){if(typeof jQuery!='undefined'){$(elCell.element).ColorPickerSetColor(data);$(elCell.element).css('backgroundColor','#'+data);}
else{elCell.element.value=data;}}
break;case ColummType.image:elCell.elContainerFile.innerHTML=data==null?"":"<img src='"+oHead.path+data+"' border='0' />";break;case ColummType.file:break;case ColummType.number:elCell.element.value=data==null?"0":utilObj.formatNumber(data,'.');if(oHead.updateIsReadOnly){elCell.element.readOnly=!this.isAddNewRecord;}
break;case ColummType.time:var vDate;if(data!=null){if(typeof data=="string"){if(Date.checkStringVN(data)){vDate=Date.parseDateVN(data);}
else{vDate=Date.parseDate(data,Date.stringFormat.time);}}
else{vDate=data;}}
elCell.element.value=vDate==null?"00:00:00":vDate.toTimeString();if(oHead.updateIsReadOnly){elCell.element.readOnly=!this.isAddNewRecord;}
break;case ColummType.email:case ColummType.textBox:case ColummType.textArea:case ColummType.keyUpdate:elCell.element.value=data==null?"":data;if(oHead.updateIsReadOnly){elCell.element.readOnly=!this.isAddNewRecord;}
break;case ColummType.radioBox:var listElement=elCell.listElement;for(var i=0;i<listElement.length;i++){if(data==null){listElement[i].checked=false;}
else{listElement[i].checked=data==listElement[i].value;}
if(oHead.updateIsReadOnly){listElement[i].readOnly=!this.isAddNewRecord;}}
break;case ColummType.multiSelectBox:if(typeof(data)=='string'){data=data.split(oHead.dataMSB.textSeparator);}
var dicData=utilObj.convertArrayToDictionary(data==null?new Object():data);elCell.element.selectedValues(dicData);if(oHead.updateIsReadOnly){elCell.element.setReadOnly(!this.isAddNewRecord);}
break;case ColummType.selectBox:if(oHead.updateIsReadOnly){elCell.element.setReadOnly(!this.isAddNewRecord);}
if(data!=null){elCell.element.selectedValue(data);}
break;case ColummType.tripleBox:var value=data==null?"":data;if(value!=""){elCell.element.setValue(value);}
if(oHead.updateIsReadOnly){elCell.element.setReadOnly(!this.isAddNewRecord);}
break;case ColummType.checkBox:elCell.element.checked=data==null?false:data;if(oHead.updateIsReadOnly){elCell.element.readOnly=!this.isAddNewRecord;}
break;case ColummType.richText:elCell.element.setContent(data==null?"":data);if(oHead.updateIsReadOnly){elCell.element.setReadOnly(!this.isAddNewRecord);}
break;case ColummType.date:elCell.element.setDate(data==null?"":data);if(oHead.updateIsReadOnly){if(!this.isAddNewRecord){elCell.element.disable();}
else{elCell.element.enable();}}
break;}
return"";};GridViewBTD.prototype.setValueFieldFormUpdate=function(oHead,itemData,dataTreeView){var elCell=oHead.elCellFormUpdate;if(oHead.callAuto!=null){oHead.callAuto();}
var data=dataTreeView!=null?dataTreeView:itemData!=null?itemData[oHead.field]:oHead.defaultValue;return this.setValueForElement(oHead,data);};GridViewBTD.prototype.getElementFieldFormUpdate=function(oHead){return oHead.elCellFormUpdate.element;};GridViewBTD.prototype.getValueFieldFormUpdate=function(oHead){var elCell=oHead.elCellFormUpdate;switch(oHead.typeUpdate){case ColummType.time:var v=Date.parseDate(elCell.element.value,Date.stringFormat.time);var oDate=new Date();v.setMonth(oDate.getMonth(),1);v.setFullYear(oDate.getFullYear());return v;case ColummType.color:return utilObj.rgbToHex($(elCell.element).css('backgroundColor'));case ColummType.number:return elCell.element.value.replace(/\./gi,"").replace(/\,/gi,".");case ColummType.password:return elCell.element.value;case ColummType.email:case ColummType.textBox:case ColummType.textArea:return elCell.element.value.trim();case ColummType.keyUpdate:return elCell.element.value.trim();case ColummType.radioBox:for(var i=0;i<elCell.listElement.length;i++){if(elCell.listElement[i].checked){return elCell.listElement[i].value;}}
return null;case ColummType.selectBox:return elCell.element.getValue();case ColummType.multiSelectBox:if(oHead.valueIsString){return elCell.element.getValue();}
else{return elCell.element.getValueArray();}
case ColummType.tripleBox:return elCell.element.getValue();case ColummType.checkBox:return elCell.element.checked;case ColummType.richText:return elCell.element.getContent();case ColummType.date:return elCell.element.getDate();case ColummType.file:case ColummType.image:return elCell.element.name;}
return"";};GridViewBTD.prototype.resetFieldFormUpdate=function(oHead){var elCell=oHead.elCellFormUpdate;switch(oHead.typeUpdate){case ColummType.password:case ColummType.email:case ColummType.textBox:case ColummType.textArea:case ColummType.keyUpdate:elCell.element.value="";break;case ColummType.number:elCell.element.value="0";break;case ColummType.radioBox:for(var i=0;i<elCell.listElement.length;i++){elCell.listElement[i].checked=false;}
break;case ColummType.selectBox:case ColummType.multiSelectBox:case ColummType.tripleBox:case ColummType.date:elCell.element.reset();break;case ColummType.checkBox:elCell.element.checked=false;break;case ColummType.richText:elCell.element.setContent("");break;}};GridViewBTD.prototype.resetFormUpdate=function(){for(var i=0;i<this.configData.head.length;i++){var itemHeader=this.configData.head[i];if(itemHeader.typeUpdate!=ColummType.none){this.resetFieldFormUpdate(itemHeader);}}
this.elContainerFormUpdate.reset();};GridViewBTD.prototype.initDataFormUpdate=function(){this.resetFormUpdate();var couter=0;for(var i=0;i<this.configData.head.length;i++){var itemHeader=this.configData.head[i];if(couter==0&&itemHeader.typeUpdate!=ColummType.keyUpdate&&itemHeader.typeUpdate!=ColummType.none){couter=i;}
if(itemHeader.typeUpdate!=ColummType.none){var dataTreeView=this.isAddNewRecord?(itemHeader.treeView!=null?itemHeader.treeView.getKeyOfItemActive():null):null;this.setValueFieldFormUpdate(itemHeader,this.isAddNewRecord?null:this.elRowEdit.item,dataTreeView);}}
if(couter>0){this.focusElement(this.configData.head[couter]);}};GridViewBTD.prototype.responseComplete=function(e){var newE=new Object();newE["isAddNew"]=this.isAddNewRecord;try{if(this.hasFile){var i=e.elIframe;if(i.contentDocument){var d=i.contentDocument;}
else if(i.contentWindow){var d=i.contentWindow.document;}
if(d.location.href=="about:blank"){return;}
console.log(Encoder.htmlDecode(utilObj.stripHtmlTags(d.body.innerHTML)));newE["responseData"]=JSON.eval(Encoder.htmlDecode(utilObj.stripHtmlTags(d.body.innerHTML)));if(newE["responseData"]!=null&&!newE["responseData"].hasErrors){this.popupFormUpdate.hide();}}
else{newE["responseData"]=e.result;if(e.result!=null&&e.error==null&&!e.result.hasErrors){this.popupFormUpdate.hide();}}}
catch(err){alert("Error 'responseComplete': "+err.message);}
try{this.executeEventNormal(newE,EventName.submitComplete);}
catch(err){alert("Error 'responseComplete.executeEventNormal': "+err.message);}};GridViewBTD.prototype.submit=function(itemData,action){if(action==null)return;if(this.hasFile){this.elContainerFormUpdate.elObjectJson.value=JSON.stringify(itemData);this.elContainerFormUpdate.action=action;this.elContainerFormUpdate.submit();}
else{if(action instanceof Function){var self=this;action(itemData,function(e){self.responseComplete(e);});}}};GridViewBTD.prototype.checkFormUpdate=function(e){var itemData=new Object();for(var i=0;i<this.configData.head.length;i++){var itemHeader=this.configData.head[i];if(itemHeader.typeUpdate!=ColummType.none){if(this.checkFieldFormUpdate(itemHeader)){itemData[itemHeader.field]=this.getValueFieldFormUpdate(itemHeader);}
else{return null;}}}
if(e==null){e=utilObj.getWindowEvent();if(e==null){e=new Object();}}
e["isAddNew"]=this.isAddNewRecord;e["itemData"]=itemData;this.executeEventNormal(e,EventName.submit);};GridViewBTD.prototype.createBtnFormUpdate=function(){var self=this;var elDiv=utilObj.createEl("DIV");elDiv.className='bgButton';elDiv.style.textAlign="center";elDiv.style.padding="5px";this.elContainerFormUpdate.appendChild(elDiv);elDiv.elBtnOk=utilObj.createEl("A");elDiv.elBtnOk.title='Lưu';elDiv.elBtnOk.className='cBtnIcon';elDiv.elBtnOk.style.marginRight='10px';elDiv.elBtnOk.innerHTML='<span class="ok">Lưu</span>';utilObj.addEvent(elDiv.elBtnOk,"click",function(e){self.checkFormUpdate(e);});elDiv.appendChild(elDiv.elBtnOk);elDiv.elBtnCancel=utilObj.createEl("A");elDiv.elBtnCancel.title='Đóng';elDiv.elBtnCancel.className='cBtnIcon';elDiv.elBtnCancel.innerHTML='<span class="cancel">Đóng</span>';utilObj.addEvent(elDiv.elBtnCancel,"click",function(e){self.popupFormUpdate.hide();});elDiv.appendChild(elDiv.elBtnCancel);this.elContainerFormUpdate.elObjectJson=utilObj.createEl("INPUT");this.elContainerFormUpdate.elObjectJson.name="DataJsonObject";this.elContainerFormUpdate.elObjectJson.type="hidden";this.elContainerFormUpdate.elObjectJson.value="";this.elContainerFormUpdate.appendChild(this.elContainerFormUpdate.elObjectJson);};GridViewBTD.prototype.setTitleFormUpdate=function(textTitle){this.textTitleFormUpdate=textTitle;if(this.popupFormUpdate){this.popupFormUpdate.setTitle(this.textTitleFormUpdate);}};GridViewBTD.prototype.disposeFormUpdate=function(){};GridViewBTD.prototype.createFormUpdate=function(){var self=this;this.elContainerFormUpdate=utilObj.createEl("FORM");this.elContainerFormUpdate.className="popupFormUpdateGV";utilObj.addChildToBody(this.elContainerFormUpdate);this.popupFormUpdate=new ModalPopup(this.elContainerFormUpdate,this.textTitleFormUpdate);this.popupFormUpdate.setZIndex(50000);this.disposeFormUpdate=function(){self.popupFormUpdate.clear();};var elDivStyle=utilObj.createEl("DIV");elDivStyle.className="body";this.elContainerFormUpdate.appendChild(elDivStyle);var elTable=utilObj.createEl("TABLE");elTable.id="formUpdateGV"+this.myName;elTable.className="table";elTable.border=elTable.cellPadding=elTable.cellSpacing=0;this.elTableFormUpdate=elTable;elDivStyle.appendChild(elTable);for(var i=0;i<this.configData.head.length;i++){var itemHeader=this.configData.head[i];if(itemHeader.typeUpdate!=ColummType.none){this.createFieldFormUpdate(itemHeader);}}
this.createBtnFormUpdate();if(this.hasFile){var elIframe=utilObj.createEl("IFRAME");elIframe.name=elIframe.id="iframeUpdateDataGV"+this.myName;elIframe.style.position="absolute";elIframe.style.top=elIframe.style.left="-1000px";elIframe.style.width=elIframe.style.height="0px";this.elContainerFormUpdate.appendChild(elIframe);utilObj.addEvent(elIframe,"load",function(e){e["elIframe"]=elIframe;self.responseComplete(e);});this.elContainerFormUpdate.method="post";this.elContainerFormUpdate.encoding="multipart/form-data";this.elContainerFormUpdate.target=elIframe.id;}};GridViewBTD.prototype.showFormUpdate=function(isAddNewRecord){this.isAddNewRecord=isAddNewRecord;if(this.elContainerFormUpdate==null){this.createFormUpdate();}
this.popupFormUpdate.display();this.popupFormUpdate.setZIndex(10000);this.initDataFormUpdate();};GridViewBTD.prototype.reloadFormUpdate=function(){if(this.elContainerFormUpdate!=null){for(var i=0;i<this.configData.head.length;i++){var itemHeader=this.configData.head[i];if(itemHeader.typeUpdate==ColummType.selectBox||itemHeader.typeUpdate==ColummType.multiSelectBox){var data=itemHeader.typeUpdate==ColummType.selectBox?itemHeader.dataDDL:itemHeader.dataMSB;itemHeader.elCellFormUpdate.element.reloadData(data);}}}};GridViewBTD.prototype.createFunctionAddNew=function(elRow){if(!this.isShowAddNew&&!this.isShowEdit&&!this.isShowDelete&&this.isHideColumnFunction)return;var self=this;elCell=elRow.insertCell(elRow.cells.length);elCell.style.textAlign="center";elCell.isFunctionGV=true;utilObj.addEvent(elCell,"mouseover",function(e){if(!self.startResizeCol)elRow.style.cursor="default";});if(!this.isShowAddNew){var elDiv=utilObj.createEl("DIV");elDiv.className=this.cssHeaderText;elDiv.innerHTML=" ";elCell.appendChild(elDiv);return;}
var elA=utilObj.createEl("A");elA.className='btnAddRecord';elA.style.padding="4px";elA.innerHTML=this.isShowTextFunction?"Thêm mới":"";elA.href="javascript:void(0);";elCell.appendChild(elA);elCell.element=elA;this.elAddNewRecord=elA;utilObj.addEvent(elA,"click",function(e){self.showAddNewRecord(e);});};GridViewBTD.prototype.showAddNewRecord=function(e){if(this.useUpdateDataSystem){this.executeEvent(e,this.elAddNewRecord,EventName.beforeSubmit);if(e.cancel)return;this.showFormUpdate(true);}
else{this.executeEvent(e,this.elAddNewRecord,EventName.insertNewRecord);}};GridViewBTD.prototype.showFormUpdateByRow=function(elRow){this.elRowEdit=elRow;if(this.useUpdateDataSystem){this.showFormUpdate(false);}};GridViewBTD.prototype.createFunctionUpdate=function(elRow){if(!this.isShowAddNew&&!this.isShowEdit&&!this.isShowDelete&&this.isHideColumnFunction)return;var elCell=elRow.insertCell(elRow.cells.length);elCell.style.textAlign="center";elCell.isFunctionUpdate=true;var self=this;if(this.isShowEdit){elCell.elEdit=utilObj.createEl("A");elCell.elEdit.className='btnEditRecord';elCell.elEdit.innerHTML=this.isShowTextFunction?"Sửa":"";elCell.elEdit.href="javascript:void(0);";elCell.appendChild(elCell.elEdit);elRow.elEdit=elCell.elEdit;utilObj.addEvent(elCell.elEdit,"click",function(e){self.elRowEdit=elRow;if(self.useUpdateDataSystem){self.showFormUpdate(false);}
else{self.executeEvent(e,elCell.elEdit,EventName.editRecord);}});}
if(this.isShowEdit&&this.isShowDelete){elCell.appendChild(utilObj.createElText(" - "));}
if(this.isShowDelete){elCell.elDelete=utilObj.createEl("A");elCell.elDelete.className='btnDeleteRecord';elCell.elDelete.innerHTML=this.isShowTextFunction?"Xóa":"";elCell.elDelete.href="javascript:void(0);";elCell.appendChild(elCell.elDelete);elRow.elDelete=elCell.elDelete;utilObj.addEvent(elCell.elDelete,"click",function(e){self.executeEvent(e,elCell.elDelete,EventName.deleteRecord);});}
return elCell;};GridViewBTD.prototype.createHyperLink=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=utilObj.createEl("A");if(oHead.fieldURL!=null&&elRow.item[oHead.fieldURL]){if(elRow.item[oHead.fieldURL].indexOf("http")==0){elCell.element.href=elRow.item[oHead.fieldURL];}
else{elCell.element.href="http://"+elRow.item[oHead.fieldURL];}
elCell.element.target='_blank';}
else{elCell.element.href="javascript:void(0)";}
elCell.element.innerHTML=(elRow.item[oHead.field]==null)?"":elRow.item[oHead.field];elCell.appendChild(elCell.element);this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createLinkFile=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=utilObj.createEl("A");elCell.element.href=oHead.path+elRow.item[oHead.field];elCell.element.innerHTML=(elRow.item[oHead.field]==null)?"":elRow.item[oHead.field];elCell.appendChild(elCell.element);this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createLinkButton=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=utilObj.createEl("A");elCell.element.href="javascript:void(0);";elCell.element.innerHTML=(elRow.item[oHead.field]==null)?"":elRow.item[oHead.field];elCell.appendChild(elCell.element);this.mapEvent(elCell.element,oHead.name);if(oHead.action!=null){var self=this;var element=elCell.element;utilObj.addEvent(elCell.element,"click",function(e){self.executeEvenGasHuongDuongButton(e,element,oHead.action,elRow);});}};GridViewBTD.prototype.executeEvenGasHuongDuongButton=function(e,element,func,elRow){if(typeof(func)=="string"){eval(func)(element,elRow);}
else if(func instanceof Function){func(element,elRow);}};GridViewBTD.prototype.createPassword=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=utilObj.createEl("LABEL");elCell.element.innerHTML='******';elCell.appendChild(elCell.element);this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createTextBox=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=utilObj.createEl("INPUT");elCell.element.type="text";elCell.element.style.width="100%";elCell.element.className="inputText";elCell.element.value=(elRow.item[oHead.field]==null)?"":elRow.item[oHead.field];elCell.appendChild(elCell.element);utilObj.addEvent(elCell.element,EventName.change,function(e){elRow.item['old-'+oHead.field]=elRow.item[oHead.field];elRow.item[oHead.field]=elCell.element.value;});this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createTripleBox=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=new TripleBoxBTD(elCell);elCell.element.init();if(elRow.item[oHead.field]!=null){elCell.element.setValue(elRow.item[oHead.field]);}
elCell.element.addEvent(EventNameTB.change,function(e){elRow.item['old-'+oHead.field]=elRow.item[oHead.field];elRow.item[oHead.field]=elCell.element.getValue();});this.mapEventTripBox(elCell.element,oHead.name);};GridViewBTD.prototype.createCheckBox=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=utilObj.createEl("INPUT");elCell.element.type="checkbox";elCell.appendChild(elCell.element);if(elRow.item[oHead.field]!=null&&typeof elRow.item[oHead.field]=="boolean"){elCell.element.checked=elRow.item[oHead.field];}
utilObj.addEvent(elCell.element,EventName.change,function(e){elRow.item['old-'+oHead.field]=elRow.item[oHead.field];elRow.item[oHead.field]=elCell.element.checked;});this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createRadioBox=function(elCell,oHead){function addEventRB(elRadio){utilObj.addEvent(elRadio,EventName.change,function(e){var x=document.getElementsByName(elRadio.name);for(var k=0;k<x.length;k++){if(x[k].checked){elRow.item[oHead.field]=x[k].value;break;}}});}
var elRow=elCell.parentNode;var t=(new Date()).getTime();elCell.listElement=[];for(var i=0;i<oHead.listItem.length;i++){var elRadio=utilObj.createEl("INPUT");elRadio.id=this.myName+oHead.name+t+''+elRow.rowIndex+''+i;elRadio.name=this.myName+oHead.name+t+''+elRow.rowIndex;elRadio.type="radio";elRadio.checked=elRow.item[oHead.field]==oHead.listItem[i].value;elRadio.value=oHead.listItem[i].value;elCell.appendChild(elRadio);elCell.listElement.push(elRadio);var elLabel=utilObj.createEl("LABEL");elLabel.htmlFor=elRadio.id;elLabel.innerHTML=oHead.listItem[i].text;elCell.appendChild(elLabel);addEventRB(elRadio);this.mapEvent(elRadio,oHead.name);}};GridViewBTD.prototype.createOption=function(item){var elOption=utilObj.createEl("OPTION");elOption.text=item.text;elOption.value=item.value;return elOption;};GridViewBTD.prototype.createSelectBox=function(elCell,oHead){var elRow=elCell.parentNode;var t=(new Date()).getTime();elCell.element=new DropDownListBTD(elCell,oHead.dataDDL,"oDDL"+this.myName+oHead.name+t+''+elRow.rowIndex,"",false);elCell.element.setWidth("100%");elCell.element.selectedValue(elRow.item[oHead.field]);utilObj.addEvent(elCell.element,EventName.change,function(e){elRow.item['old-'+oHead.field]=elRow.item[oHead.field];elRow.item[oHead.field]=elCell.element.getValue(oHead.dataDDL.useQuote);});this.mapEventDropDownList(elCell.element,oHead.name);};GridViewBTD.prototype.createLabelSelectBox=function(elCell,oHead){var elRow=elCell.parentNode;var re="";var data=elRow.item[oHead.field];if(data!=null){if(oHead.dataDDL.dataDic[data]!=null){re=oHead.dataDDL.dataDic[data][oHead.dataDDL.mapField.text];}}
elCell.element=utilObj.createEl("LABEL");elCell.element.innerHTML=re;elCell.appendChild(elCell.element);if(!oHead.isNoShowTitle){elCell.element.title=elCell.element.innerHTML;}
this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createLabelEditSelectBox=function(elCell,oHead){var elRow=elCell.parentNode;var re="";var data=elRow.item[oHead.field];if(data!=null){if(oHead.dataDDL.dataDic[data]!=null){re=oHead.dataDDL.dataDic[data][oHead.dataDDL.mapField.text];}}
elCell.element=utilObj.createEl("DIV");elCell.element.innerHTML=re;elCell.appendChild(elCell.element);if(!oHead.isNoShowTitle){elCell.element.title=elCell.element.innerHTML;}
utilObj.addEvent(elCell.element,EventName.mouseDown,function(){elCell.element.style.display='none';oHead.elConEditSelectBox.style.display='';oHead.elEditSelectBox.setWidth('100%');elCell.appendChild(oHead.elConEditSelectBox);oHead.elEditSelectBox.selectedValue(elRow.item[oHead.field]);oHead.elEditSelectBox.showList();oHead.elEditSelectBox.funcChange=function(){elCell.element.style.display='';oHead.elConEditSelectBox.style.display='none';elRow.item[oHead.field]=oHead.elEditSelectBox.getValue();elCell.element.innerHTML=oHead.elEditSelectBox.getText();if(oHead.funcChange!=null){oHead.funcChange(elRow.item);}};});this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createLabelMultiSelectBox=function(elCell,oHead){var elRow=elCell.parentNode;var re="";var list=elRow.item[oHead.field];if(list!=null){if(typeof(list)=='string'){list=list.split(oHead.dataMSB.textSeparator);}
if(list instanceof Array){for(var i=0;i<list.length;i++){if(list[i]==null||oHead.dataMSB.dataDic[list[i]]==null)continue;var data=oHead.dataMSB.dataDic[list[i]][oHead.dataMSB.mapField.text];if(data!=null){if(re!="")re+="; ";re+=data;}}}}
elCell.element=utilObj.createEl("LABEL");elCell.element.innerHTML=re;elCell.appendChild(elCell.element);if(!oHead.isNoShowTitle){elCell.element.title=elCell.element.innerHTML;}
this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createMultiSelectBox=function(elCell,oHead){var elRow=elCell.parentNode;var dicData=utilObj.convertArrayToDictionary(elRow.item[oHead.field]);var t=(new Date()).getTime();elCell.element=new MultiSelectBoxBTD(elCell,oHead.dataMSB,"oMSB"+this.myName+oHead.name+t+''+elRow.rowIndex);elCell.element.setWidth("100%");elCell.element.selectedValues(dicData);utilObj.addEvent(elCell.element,EventName.change,function(e){elRow.item['old-'+oHead.field]=elRow.item[oHead.field];elRow.item[oHead.field]=elCell.element.getValueArray(oHead.dataMSB.useQuote);});this.mapEventMultiSelectBox(elCell.element,oHead.name);};GridViewBTD.prototype.createLabel=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=utilObj.createEl("LABEL");if(!oHead.isNoShowTitle){elCell.element.title=utilObj.stripHtmlTags((elRow.item[oHead.field]==null)?"":elRow.item[oHead.field]);}
elCell.element.innerHTML=(elRow.item[oHead.field]==null)?"":elRow.item[oHead.field];elCell.appendChild(elCell.element);this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.convertFormula=function(field,item){for(var key in item){field=field.replace(eval('\/\\['+key+'\\]\/gi'),item[key]);}
return field;};GridViewBTD.prototype.createFormula=function(elCell,oHead){elCell.style.textAlign='right';var elRow=elCell.parentNode;elCell.element=utilObj.createEl("LABEL");var formula=this.convertFormula(oHead.field,elRow.item);var v=utilObj.calculateFormula(formula);if(isNaN(v)||!isFinite(v))v=0;elCell.element.valueTotalFormula=v;elCell.element.innerHTML=utilObj.formatNumber(v,".",1);if(oHead.unit!=null&&oHead.unit.text!=null){if(oHead.unit.isFrontOf){elCell.element.innerHTML=oHead.unit.text+" "+elCell.element.innerHTML;}
else{elCell.element.innerHTML+=" "+oHead.unit.text;}}
elCell.appendChild(elCell.element);this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createNumber=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=utilObj.createEl("INPUT");elCell.element.type="text";elCell.element.style.width="100%";elCell.element.className="inputText";var v=elRow.item[oHead.field];if(v!=null){v=(v+"").replace(/\./gi,",");v=utilObj.formatNumber(v,".");elCell.element.value=v;utilObj.numeric(elCell.element);}
elCell.appendChild(elCell.element);var me=this;$(elCell.element).change(function(e){oHead.total-=elRow.item[oHead.field];elRow.item['old-'+oHead.field]=elRow.item[oHead.field];elRow.item[oHead.field]=parseFloat(elCell.element.value.replace(/\./gi,"").replace(/\,/gi,"."));oHead.total+=elRow.item[oHead.field];me.calFormulaSum(elRow);me.calcTotal();});this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.calFormulaSum=function(elRow){for(var i=0;i<this.configData.head.length;i++){var oHead=this.configData.head[i];if(oHead.type==ColummType.formula){var formula=this.convertFormula(oHead.field,elRow.item);var v=utilObj.calculateFormula(formula);var elCell=elRow.cells[this.getColumnIndex(oHead.name)];oHead.total-=elCell.element.valueTotalFormula;elCell.element.valueTotalFormula=v;oHead.total+=v;elCell.element.innerHTML=utilObj.formatNumber(v,".",1);if(oHead.unit!=null&&oHead.unit.text!=null){if(oHead.unit.isFrontOf){elCell.element.innerHTML=oHead.unit.text+" "+elCell.element.innerHTML;}
else{elCell.element.innerHTML+=" "+oHead.unit.text;}}}}
return formula;};GridViewBTD.prototype.createColor=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=utilObj.createEl("DIV");elCell.appendChild(elCell.element);elCell.element.style.border="1px solid #808080";elCell.element.style.fontSize="0px";elCell.element.style.width="15px";elCell.element.style.height="15px";if(elRow.item[oHead.field]!=null&&typeof elRow.item[oHead.field]=="string"&&elRow.item[oHead.field].length==6){elCell.element.style.backgroundColor="#"+elRow.item[oHead.field];}
this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createLabelCheckBox=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=utilObj.createEl("LABEL");elCell.appendChild(elCell.element);if(elRow.item[oHead.field]!=null&&typeof elRow.item[oHead.field]=="boolean"){elCell.element.innerHTML=elRow.item[oHead.field]?oHead.valueTrue:oHead.valueFalse;if(!oHead.isNoShowTitle){elCell.element.title=utilObj.stripHtmlTags(elCell.element.innerHTML);}}
this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createLabelNumber=function(elCell,oHead){var elRow=elCell.parentNode;elCell.style.textAlign='right';elCell.element=utilObj.createEl("LABEL");var v=elRow.item[oHead.field];if(v!=null){v=(v+"").replace(/\./gi,",");v=utilObj.formatNumber(v,".");elCell.element.innerHTML=v;}
elCell.appendChild(elCell.element);if(oHead.unit!=null&&oHead.unit.text!=null){if(oHead.unit.isFrontOf){elCell.element.innerHTML=oHead.unit.text+" "+elCell.element.innerHTML;}
else{elCell.element.innerHTML+=" "+oHead.unit.text;}}
if(!oHead.isNoShowTitle){elCell.element.title=elCell.element.innerHTML;}
this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createLabelTime=function(elCell,oHead){var elRow=elCell.parentNode;var value="";if(elRow.item[oHead.field]!=""&&elRow.item[oHead.field]!=null){if(!(elRow.item[oHead.field]instanceof Date)){elRow.item[oHead.field]=Date.parseDate(elRow.item[oHead.field],Date.stringFormat.dateTime);}
value=elRow.item[oHead.field].toVNString(Date.stringFormat.time);}
elCell.element=utilObj.createEl("LABEL");elCell.element.innerHTML=value;elCell.appendChild(elCell.element);if(!oHead.isNoShowTitle){elCell.element.title=elCell.element.innerHTML;}
this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createLabelDate=function(elCell,oHead){var elRow=elCell.parentNode;var value="";if(elRow.item[oHead.field]!=""&&elRow.item[oHead.field]!=null){try{if(!(elRow.item[oHead.field]instanceof Date)){if(Date.checkStringVN(elRow.item[oHead.field])){elRow.item[oHead.field]=Date.parseDateVN(elRow.item[oHead.field]);}
else{elRow.item[oHead.field]=Date.parseDate(elRow.item[oHead.field],Date.stringFormat.dateTime);}}
value=elRow.item[oHead.field].toVNString(Date.stringFormat.date);}catch(e){value=elRow.item[oHead.field];}}
elCell.element=utilObj.createEl("LABEL");elCell.element.innerHTML=value;elCell.appendChild(elCell.element);if(!oHead.isNoShowTitle){elCell.element.title=elCell.element.innerHTML;}
this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createLabelDateTime=function(elCell,oHead){var elRow=elCell.parentNode;var value="";if(elRow.item[oHead.field]!=""&&elRow.item[oHead.field]!=null){if(!(elRow.item[oHead.field]instanceof Date)){elRow.item[oHead.field]=Date.parseDate(elRow.item[oHead.field],Date.stringFormat.dateTime);}
value=elRow.item[oHead.field].toVNString();}
elCell.element=utilObj.createEl("LABEL");elCell.element.innerHTML=value;elCell.appendChild(elCell.element);if(!oHead.isNoShowTitle){elCell.element.title=elCell.element.innerHTML;}
this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createImage=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=utilObj.createEl("IMG");if(elRow.item[oHead.field]==null||elRow.item[oHead.field]==''){elCell.element.src=oHead.pathNoImage;}
else{elCell.element.src=oHead.path+elRow.item[oHead.field];}
elCell.appendChild(elCell.element);this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createTextArea=function(elCell,oHead){var elRow=elCell.parentNode;elCell.element=utilObj.createEl("TEXTAREA");elCell.element.style.width="100%";elCell.element.rows=4;elCell.element.className="inputText";elCell.element.value=(elRow.item[oHead.field]==null)?"":elRow.item[oHead.field];elCell.appendChild(elCell.element);$(elCell.element).change(function(e){elRow.item['old-'+oHead.field]=elRow.item[oHead.field];elRow.item[oHead.field]=elCell.element.value;});this.mapEvent(elCell.element,oHead.name);};GridViewBTD.prototype.createDate=function(elCell,oHead){var elRow=elCell.parentNode;var t=(new Date()).getTime();elCell.element=new CalendarBTD(elCell,"elCalendar"+this.myName+oHead.name+t+''+elRow.rowIndex,"",false);elCell.element.setWidth("100%");var value=elRow.item[oHead.field];if(value!=null){if(!(value instanceof Date)){value=Date.parseDate(value,Date.stringFormat.dateTime);}
elCell.element.setDate(value);}
elCell.element.addEvent(EventNameCalendar.change,function(e){elRow.item['old-'+oHead.field]=elRow.item[oHead.field];elRow.item[oHead.field]=elCell.element.getDate();});this.mapEventCalendar(elCell.element,oHead.name);};GridViewBTD.prototype.createRichText=function(elCell,oHead){var elRow=elCell.parentNode;var t=(new Date()).getTime();elCell.element=new ObjectIframe(elCell,"elementRTE"+this.myName+oHead.name+t+''+elRow.rowIndex,(elRow.item[oHead.field]==null)?"":elRow.item[oHead.field],"100%",60,"inputText");elCell.element.addEvent(EventName.change,function(e){elRow.item['old-'+oHead.field]=elRow.item[oHead.field];elRow.item[oHead.field]=elCell.element.getContent();});this.mapEventRichText(elCell.element,oHead.name);};GridViewBTD.prototype.mapEventForRow=function(elRow){var self=this;elRow["onclick"]=function(e){self.executeEventForRow(e,elRow,EventName.rowClick);};elRow["ondblclick"]=function(e){self.executeEventForRow(e,elRow,EventName.rowDblClick);};elRow["onmousedown"]=function(e){self.executeEventForRow(e,elRow,EventName.rowMouseDown);};elRow["onmousemove"]=function(e){self.executeEventForRow(e,elRow,EventName.rowMouseMove);};elRow["onmouseout"]=function(e){self.executeEventForRow(e,elRow,EventName.rowMouseOut);};elRow["onmouseover"]=function(e){self.executeEventForRow(e,elRow,EventName.rowMouseOver);};elRow["onmouseup"]=function(e){self.executeEventForRow(e,elRow,EventName.rowMouseUp);};};GridViewBTD.prototype.mapEvent=function(element,name){var self=this;element["onclick"]=function(e){self.executeEvent(e,element,name+EventName.click);};element["onblur"]=function(e){self.executeEvent(e,element,name+EventName.blur);};element["onfocus"]=function(e){self.executeEvent(e,element,name+EventName.focus);};element["onchange"]=function(e){self.executeEvent(e,element,name+EventName.change);};element["ondblclick"]=function(e){self.executeEvent(e,element,name+EventName.dblClick);};element["onkeydown"]=function(e){self.executeEvent(e,element,name+EventName.keyDown);};element["onkeypress"]=function(e){self.executeEvent(e,element,name+EventName.keyPress);};element["onkeyup"]=function(e){self.executeEvent(e,element,name+EventName.keyUp);};element["onmousedown"]=function(e){self.executeEvent(e,element,name+EventName.mouseDown);};element["onmousemove"]=function(e){self.executeEvent(e,element,name+EventName.mouseMove);};element["onmouseout"]=function(e){self.executeEvent(e,element,name+EventName.mouseOut);};element["onmouseover"]=function(e){self.executeEvent(e,element,name+EventName.mouseOver);};element["onmouseup"]=function(e){self.executeEvent(e,element,name+EventName.mouseUp);};};GridViewBTD.prototype.mapEventRichText=function(element,name){var self=this;var elChild=element.elIframe;element.addEvent(EventNameRTE.change,function(e){self.executeEvent(e,elChild,name+EventName.change);});};GridViewBTD.prototype.mapEventDropDownList=function(element,name){var self=this;var elChild=element.elContainer;element.addEvent(EventNameDDL.change,function(e){self.executeEvent(e,elChild,name+EventName.change);});element.addEvent(EventNameDDL.click,function(e){self.executeEvent(e,elChild,name+EventName.click);});};GridViewBTD.prototype.mapEventTripBox=function(element,name){var self=this;var elChild=element.elContainer;element.addEvent(EventNameTB.change,function(e){self.executeEvent(e,elChild,name+EventNameTB.change);});};GridViewBTD.prototype.mapEventMultiSelectBox=function(element,name){var self=this;var elChild=element.elContainer;element.addEvent(EventNameMSB.change,function(e){self.executeEvent(e,elChild,name+EventName.change);});element.addEvent(EventNameMSB.click,function(e){self.executeEvent(e,elChild,name+EventName.click);});};GridViewBTD.prototype.mapEventCalendar=function(element,name){var self=this;var elChild=element.elContainer;element.addEvent(EventNameCalendar.change,function(e){self.executeEvent(e,elChild,name+EventName.change);});element.addEvent(EventNameCalendar.click,function(e){self.executeEvent(e,elChild,name+EventName.click);});};GridViewBTD.prototype.executeEvent=function(e,element,eventName){e=utilObj.getWindowEvent();e.elementCell=element.parentNode;this.executeEventForRow(e,e.elementCell.parentNode,eventName);};GridViewBTD.prototype.executeEventForRow=function(e,elRow,eventName){if(e==null){e=utilObj.getWindowEvent();}
e.elementRow=elRow;var elFunctionUpdate=utilObj.getTargetElement();var isFunctionUpdate=true;if(elFunctionUpdate!=null&&elFunctionUpdate.isFunctionUpdate==null){if(elFunctionUpdate.parentNode!=null){isFunctionUpdate=elFunctionUpdate.parentNode.isFunctionUpdate!=null;}
else{isFunctionUpdate=false;}}
if(this.listEvent[eventName]!=null){for(var i=0;i<this.listEvent[eventName].length;i++){if(!isFunctionUpdate||(isFunctionUpdate&&(EventName.editRecord==eventName||EventName.deleteRecord==eventName||EventName.rowDataBound==eventName))){this.listEvent[eventName][i](e);}}}};GridViewBTD.prototype.executeEventNormal=function(e,eventName){if(this.listEvent[eventName]!=null){for(var i=0;i<this.listEvent[eventName].length;i++){this.listEvent[eventName][i](e);}}};GridViewBTD.prototype.addEventForFunction=function(eventName,func){this.addEvent("",eventName,func);};GridViewBTD.prototype.removeEventForFunction=function(eventName,func){this.removeEvent("",eventName,func);};GridViewBTD.prototype.addEvent=function(colName,eventName,func){if(this.listEvent[colName+eventName]==null){this.listEvent[colName+eventName]=[];}
this.listEvent[colName+eventName].push(func);};GridViewBTD.prototype.removeEvent=function(colName,eventName,func){if(this.listEvent[colName+eventName]==null){return;}
for(var i=0;i<this.listEvent[colName+eventName].length;i++){if(func==this.listEvent[colName+eventName][i]){this.listEvent[colName+eventName].splice(i,1);break;}}};GridViewBTD.prototype.showOrHidePreviewOrNext=function(){this.elContainerPagingNext.style.display=(this.totalPage<=this.currentIndexContainerPage*this.maxPage)?"none":"";this.elContainerPagingPreview.style.display=(this.currentIndexContainerPage==1)?"none":"";}
GridViewBTD.prototype.gotoPage=function(elPageChoose,isStopEventPaging){if(this.elPageChoose==elPageChoose)return;var e=new Object();this.currentPage=elPageChoose["indexPage"];e.end=this.currentPage*this.viewRecord;e.begin=e.end-this.viewRecord+1;this.pagingRecord={begin:e.begin,end:e.end};if(this.elPageChoose!=null){this.elPageChoose.className="pageNoChoose";}
this.elPageChoose=elPageChoose;this.elPageChoose.className="pageChoose";isStopEventPaging=typeof isStopEventPaging=="undefined"?false:isStopEventPaging;if(!isStopEventPaging){this.executeEventNormal(e,EventName.pagingChange);}};GridViewBTD.prototype.gotoPreviewOrNext=function(isNext){this.listContainerPages["page"+this.currentIndexContainerPage].className="containerNoShowPage";if(isNext)this.currentIndexContainerPage++;else this.currentIndexContainerPage--;this.showOrHidePreviewOrNext();var elNow=this.listContainerPages["page"+this.currentIndexContainerPage];if(elNow!=null){elNow.className="containerShowPage";var elPage=elNow.firstChild;if(elPage.tagName.toLowerCase()!="span"){elPage=elPage.nextSibling;}
this.gotoPage(elPage);}};GridViewBTD.prototype.gotoPreview=function(){this.gotoPreviewOrNext(false);};GridViewBTD.prototype.gotoNext=function(){this.gotoPreviewOrNext(true);};GridViewBTD.prototype.setPaging=function(viewRecord,totalRecord,maxPage){if(!this.isShowPaging||this.isShowAllPage)return;this.viewRecord=viewRecord;this.totalRecord=totalRecord;this.totalPage=parseInt(totalRecord/this.viewRecord,10);this.totalPage+=(totalRecord%this.viewRecord==0)?0:1;this.pagingRecord={begin:1,end:this.viewRecord};this.maxPage=(typeof(maxPage)=="undefined")?this.maxPage:maxPage;this.listContainerPages=new Array();this.elPageChoose=null;this.currentIndexContainerPage=1;this.elContainerPagingPreview=null;this.elContainerPagingNext=null;this.elContainerGV.cFooterPaging.innerHTML="";this.elContainerGV.cFooterPaging.table=this.getPaging();this.elContainerGV.cFooterPaging.appendChild(this.elContainerGV.cFooterPaging.table);this.showOrHidePreviewOrNext();};GridViewBTD.prototype.createElPage=function(elContainerPaging,indexPage,indexContainerPaging){var self=this;var elPage=utilObj.createEl("SPAN");elPage["indexPage"]=indexPage;elPage.innerHTML=indexPage;elContainerPaging.appendChild(elPage);if(indexPage==1){elPage.className="pageChoose";this.elPageChoose=elPage;this.currentIndexContainerPage=indexContainerPaging;elContainerPaging.className="containerShowPage";}
else{elPage.className="pageNoChoose";}
utilObj.addEvent(elPage,EventName.click,function(e){self.gotoPage(elPage);});};GridViewBTD.prototype.changePageByIndex=function(indexPage,isStopEventPaging){if((indexPage>this.totalPage)||(indexPage<=0)){return;}
this.listContainerPages["page"+this.currentIndexContainerPage].className="containerNoShowPage";var currentIndex=parseInt(indexPage/this.maxPage,10);currentIndex+=(indexPage%this.maxPage==0)?0:1;this.currentIndexContainerPage=currentIndex;this.showOrHidePreviewOrNext();var elNow=this.listContainerPages["page"+this.currentIndexContainerPage];if(elNow!=null){elNow.className="containerShowPage";var elPage=null;for(var i=0;i<elNow.childNodes.length;i++){elPage=elNow.childNodes[i];if(elPage.tagName.toLowerCase()=="span"&&elPage["indexPage"]==indexPage){break;}}
if(elPage!=null)this.gotoPage(elPage,isStopEventPaging);}};GridViewBTD.prototype.textBoxGotoPage_change=function(elTextBox){elTextBox.value=elTextBox.value.trim();var indexPage=parseInt(elTextBox.value,10);if(elTextBox.value==""||isNaN(elTextBox.value)){return;}
this.changePageByIndex(indexPage,false);};GridViewBTD.prototype.createTextBoxGotoPage=function(elContainer){var self=this;var elSpan=utilObj.createEl("SPAN");elSpan.className="pagingText";elSpan.innerHTML="Tới trang: ";elContainer.appendChild(elSpan);var elTextBox=utilObj.createEl("INPUT");elTextBox.type="text";utilObj.addEvent(elTextBox,EventName.change,function(e){self.textBoxGotoPage_change(elTextBox);});utilObj.addEvent(elTextBox,EventName.focus,function(e){elTextBox.select();});elContainer.appendChild(elTextBox);};GridViewBTD.prototype.setTotalRecord=function(isInscrease){this.totalRecord+=isInscrease?1:-1;if(this.elDisplayTotalRecord){this.elDisplayTotalRecord.innerHTML="Tổng: "+utilObj.formatNumber(this.totalRecord,".");}};GridViewBTD.prototype.getPaging=function(){var totalPage=this.totalPage;var self=this;var elContainerTable=utilObj.createEl("TABLE");elContainerTable.className="containerTablePaging";elContainerTable.style.width='100%';elContainerTable.cellPadding=elContainerTable.cellSpacing=elContainerTable.border="0";var elRow=elContainerTable.insertRow(0);var elCell=elRow.insertCell(0);elCell.style.width="20%";elCell.style.textAlign="left";elCell.innerHTML="Tổng: "+utilObj.formatNumber(this.totalRecord,".");this.elDisplayTotalRecord=elCell;elCell=elRow.insertCell(1);elCell.style.width="80%";elCell.style.textAlign="right";var elContainer=utilObj.createEl("DIV");elCell.appendChild(elContainer);this.createTextBoxGotoPage(elContainer);var timeNext=parseInt(totalPage/this.maxPage,10);timeNext+=(totalPage%this.maxPage==0)?0:1;var elContainerPagingPreview=utilObj.createEl("SPAN");elContainerPagingPreview.className="pagePreview";utilObj.addEvent(elContainerPagingPreview,EventName.click,function(e){self.gotoPreview();});elContainer.appendChild(elContainerPagingPreview);this.elContainerPagingPreview=elContainerPagingPreview;for(var j=1;j<=timeNext;j++){var elContainerPaging=utilObj.createEl("SPAN");elContainerPaging.className="containerNoShowPage";elContainer.appendChild(elContainerPaging);this.listContainerPages["page"+j]=elContainerPaging;var max=j*this.maxPage;var min=max-this.maxPage+1;max=totalPage<=max?totalPage:max;for(var i=min;i<=max;i++){this.createElPage(elContainerPaging,i,j);}}
var elContainerPagingNext=utilObj.createEl("SPAN");elContainerPagingNext.className="pageNext";utilObj.addEvent(elContainerPagingNext,EventName.click,function(e){self.gotoNext();});elContainer.appendChild(elContainerPagingNext);this.elContainerPagingNext=elContainerPagingNext;return elContainerTable;};GridViewBTD.prototype.getBeginAndEndRecord=function(){return this.pagingRecord;};GridViewBTD.prototype.getCurrentIndexPage=function(){return this.elPageChoose==null?1:this.elPageChoose["indexPage"];};GridViewBTD.prototype.addDataMSBOrDDL=function(headerName,item){for(var i=0;i<this.configData.head.length;i++){var head=this.configData.head[i];if(head.name==headerName){if(head.elCellFormUpdate)head.elCellFormUpdate.element.addItem(utilObj.cloneObject(item));if(head.type==ColummType.labelMultiSelectBox){head.dataMSB.data.push(item);this.convertDataMSBOrDDL(head.dataMSB);}
else if(head.type==ColummType.labelSelectBox){head.dataDDL.data.push(item);this.convertDataMSBOrDDL(head.dataDDL);}
break;}}};GridViewBTD.prototype.updateDataMSBOrDDL=function(headerName,item){for(var i=0;i<this.configData.head.length;i++){var head=this.configData.head[i];if(head.name==headerName){if(head.elCellFormUpdate)head.elCellFormUpdate.element.updateItem(item);var configData={};if(head.type==ColummType.labelMultiSelectBox){configData=head.dataMSB;}
else if(head.type==ColummType.labelSelectBox){configData=head.dataDDL;}
for(var key in item){configData.dataDic[item[configData.mapField.value]][key]=item[key];}
break;}}};GridViewBTD.prototype.removeDataMSBOrDDL=function(headerName,value){for(var i=0;i<this.configData.head.length;i++){var head=this.configData.head[i];if(head.name==headerName){if(head.elCellFormUpdate)head.elCellFormUpdate.element.removeItem(value);var configData={};if(head.type==ColummType.labelMultiSelectBox){configData=head.dataMSB;}
else if(head.type==ColummType.labelSelectBox){configData=head.dataDDL;}
delete configData.dataDic[value];break;}}};
